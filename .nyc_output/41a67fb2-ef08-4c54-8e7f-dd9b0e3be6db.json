{"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/app.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/app.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":15},"end":{"line":6,"column":47}},"4":{"start":{"line":7,"column":24},"end":{"line":7,"column":65}},"5":{"start":{"line":8,"column":22},"end":{"line":8,"column":61}},"6":{"start":{"line":9,"column":17},"end":{"line":9,"column":51}},"7":{"start":{"line":10,"column":15},"end":{"line":10,"column":47}},"8":{"start":{"line":11,"column":19},"end":{"line":11,"column":67}},"9":{"start":{"line":12,"column":24},"end":{"line":12,"column":77}},"10":{"start":{"line":13,"column":18},"end":{"line":13,"column":65}},"11":{"start":{"line":14,"column":19},"end":{"line":14,"column":67}},"12":{"start":{"line":15,"column":17},"end":{"line":15,"column":53}},"13":{"start":{"line":16,"column":21},"end":{"line":16,"column":61}},"14":{"start":{"line":17,"column":19},"end":{"line":17,"column":57}},"15":{"start":{"line":18,"column":20},"end":{"line":18,"column":59}},"16":{"start":{"line":19,"column":19},"end":{"line":19,"column":57}},"17":{"start":{"line":20,"column":25},"end":{"line":20,"column":69}},"18":{"start":{"line":21,"column":20},"end":{"line":21,"column":59}},"19":{"start":{"line":22,"column":21},"end":{"line":22,"column":44}},"20":{"start":{"line":24,"column":0},"end":{"line":24,"column":25}},"21":{"start":{"line":26,"column":12},"end":{"line":26,"column":51}},"22":{"start":{"line":28,"column":0},"end":{"line":28,"column":41}},"23":{"start":{"line":30,"column":0},"end":{"line":32,"column":4}},"24":{"start":{"line":34,"column":20},"end":{"line":36,"column":1}},"25":{"start":{"line":37,"column":0},"end":{"line":37,"column":37}},"26":{"start":{"line":38,"column":0},"end":{"line":38,"column":33}},"27":{"start":{"line":39,"column":0},"end":{"line":39,"column":34}},"28":{"start":{"line":40,"column":0},"end":{"line":40,"column":58}},"29":{"start":{"line":41,"column":0},"end":{"line":41,"column":88}},"30":{"start":{"line":43,"column":0},"end":{"line":43,"column":58}},"31":{"start":{"line":45,"column":0},"end":{"line":45,"column":40}},"32":{"start":{"line":46,"column":0},"end":{"line":46,"column":36}},"33":{"start":{"line":47,"column":0},"end":{"line":47,"column":35}},"34":{"start":{"line":49,"column":0},"end":{"line":49,"column":36}},"35":{"start":{"line":50,"column":0},"end":{"line":50,"column":40}},"36":{"start":{"line":52,"column":0},"end":{"line":52,"column":34}},"37":{"start":{"line":54,"column":0},"end":{"line":54,"column":34}},"38":{"start":{"line":56,"column":0},"end":{"line":56,"column":38}},"39":{"start":{"line":57,"column":0},"end":{"line":57,"column":70}},"40":{"start":{"line":58,"column":0},"end":{"line":58,"column":31}},"41":{"start":{"line":59,"column":0},"end":{"line":59,"column":22}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3}},"s":{"0":1,"1":16,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1},"f":{"0":16},"b":{"0":[1,1,1],"1":[7,9],"2":[16,16]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/app.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/app.ts"],"names":[],"mappings":";;;;;AAAA,gDAAwB;AACxB,kEAAoC;AACpC,8DAAmC;AACnC,oDAA4B;AAC5B,gDAAwB;AAExB,oEAA4C;AAC5C,8EAAsD;AACtD,kEAA0C;AAC1C,oEAA4C;AAI5C,sDAA8B;AAC9B,8DAAsC;AACtC,0DAAkC;AAClC,4DAAmC;AACnC,0DAAkC;AAElC,sEAA8C;AAC9C,4DAAoC;AACpC,6CAAyC;AAEzC,qCAAqC;AACrC,sBAAS,EAAE,CAAC;AAEZ,wEAAwE;AAExE,MAAM,GAAG,GAAgB,iBAAO,CAAC,kBAAQ,EAAE,CAAC,CAAC;AAG7C,yBAAyB;AACzB,GAAG,CAAC,SAAS,CAAC,uBAAa,EAAE,CAAC,CAAC;AAC/B,+DAA+D;AAC/D,GAAG,CAAC,GAAG,CAAC,gBAAM,CAAC;IACb,qBAAqB,EAAE,KAAK;CAC7B,CAAC,CAAC,CAAC;AAEJ,6BAA6B;AAC7B,MAAM,WAAW,GAAG;IAClB,MAAM,EAAE,uBAAuB;CAChC,CAAC;AACF,GAAG,CAAC,GAAG,CAAC,cAAI,CAAC,WAAW,CAAC,CAAC,CAAC;AAE3B,GAAG,CAAC,GAAG,CAAC,qBAAQ,EAAE,CAAC,CAAC;AACpB,GAAG,CAAC,GAAG,CAAC,iBAAO,CAAC,IAAI,EAAE,CAAC,CAAC;AACxB,GAAG,CAAC,GAAG,CAAC,iBAAO,CAAC,UAAU,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;AAChD,GAAG,CAAC,GAAG,CAAC,uBAAO,CAAC,cAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,aAAa,CAAC,CAAC,CAAC,CAAC;AAC9D,yBAAyB;AACzB,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,iBAAO,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;AAEhD,+BAA+B;AAC/B,GAAG,CAAC,SAAS,CAAC,iBAAO,CAAC,IAAI,EAAE,CAAC,CAAC;AAC9B,GAAG,CAAC,SAAS,CAAC,kBAAQ,EAAE,CAAC,CAAC;AAE1B,GAAG,CAAC,SAAS,CAAC,mBAAS,CAAC,CAAC;AAEzB,yDAAyD;AACzD,GAAG,CAAC,SAAS,CAAC,oBAAU,CAAC,CAAC;AAC1B,GAAG,CAAC,SAAS,CAAC,wBAAc,CAAC,CAAC;AAC9B,gDAAgD;AAChD,GAAG,CAAC,SAAS,CAAC,kBAAQ,CAAC,CAAC;AACxB,0CAA0C;AAC1C,GAAG,CAAC,SAAS,CAAC,kBAAQ,CAAC,CAAC;AAExB,wDAAwD;AACxD,GAAG,CAAC,GAAG,CAAC,iBAAO,CAAC,QAAQ,EAAE,CAAC,CAAC;AAC5B,GAAG,CAAC,GAAG,CAAC,iBAAO,CAAC,YAAY,CAAC,EAAE,MAAM,EAAN,gBAAM,EAAS,CAAC,CAAC,CAAC;AAEjD,GAAG,CAAC,KAAK,CAAC,mBAAQ,CAAC,CAAC;AAEpB,kBAAe,GAAG,CAAC","sourcesContent":["import path from 'path';\nimport favicon from 'serve-favicon';\nimport compress from 'compression';\nimport helmet from 'helmet';\nimport cors from 'cors';\n\nimport feathers from '@feathersjs/feathers';\nimport configuration from '@feathersjs/configuration';\nimport express from '@feathersjs/express';\nimport socketio from '@feathersjs/socketio';\n\n\nimport { Application } from './declarations';\nimport logger from './logger';\nimport middleware from './middleware';\nimport services from './services';\nimport appHooks from './app.hooks';\nimport channels from './channels';\nimport { HookContext as FeathersHookContext } from '@feathersjs/feathers';\nimport authentication from './authentication';\nimport sequelize from './sequelize';\nimport { getDotEnv } from './env.config';\n\n//for environment variable management\ngetDotEnv();\n\n// Don't remove this comment. It's needed to format import lines nicely.\n\nconst app: Application = express(feathers());\nexport type HookContext<T = any> = { app: Application } & FeathersHookContext<T>;\n\n// Load app configuration\napp.configure(configuration());\n// Enable security, CORS, compression, favicon and body parsing\napp.use(helmet({\n  contentSecurityPolicy: false\n}));\n\n// Cross origin configuration\nconst corsOptions = {\n  origin: 'http://localhost:3030'\n};\napp.use(cors(corsOptions));\n\napp.use(compress());\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\napp.use(favicon(path.join(app.get('public'), 'favicon.ico')));\n// Host the public folder\napp.use('/', express.static(app.get('public')));\n\n// Set up Plugins and providers\napp.configure(express.rest());\napp.configure(socketio());\n\napp.configure(sequelize);\n\n// Configure other middleware (see `middleware/index.ts`)\napp.configure(middleware);\napp.configure(authentication);\n// Set up our services (see `services/index.ts`)\napp.configure(services);\n// Set up event channels (see channels.ts)\napp.configure(channels);\n\n// Configure a middleware for 404s and the error handler\napp.use(express.notFound());\napp.use(express.errorHandler({ logger } as any));\n\napp.hooks(appHooks);\n\nexport default app;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7b1b7b082f9686042130f37127800e53ccf98d2a"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/logger.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/logger.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":18},"end":{"line":3,"column":36}},"2":{"start":{"line":5,"column":15},"end":{"line":12,"column":2}},"3":{"start":{"line":13,"column":0},"end":{"line":13,"column":25}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1},"f":{},"b":{},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/logger.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/logger.ts"],"names":[],"mappings":";;AAAA,qCAA2D;AAE3D,wGAAwG;AACxG,MAAM,MAAM,GAAG,sBAAY,CAAC;IAC1B,sDAAsD;IACtD,KAAK,EAAE,MAAM;IACb,MAAM,EAAE,gBAAM,CAAC,OAAO,CACpB,gBAAM,CAAC,KAAK,EAAE,EACd,gBAAM,CAAC,MAAM,EAAE,CAChB;IACD,UAAU,EAAE;QACV,IAAI,oBAAU,CAAC,OAAO,EAAE;KACzB;CACF,CAAC,CAAC;AAEH,kBAAe,MAAM,CAAC","sourcesContent":["import { createLogger, format, transports } from 'winston';\n\n// Configure the Winston logger. For the complete documentation see https://github.com/winstonjs/winston\nconst logger = createLogger({\n  // To see more detailed errors, change this to 'debug'\n  level: 'info',\n  format: format.combine(\n    format.splat(),\n    format.simple()\n  ),\n  transports: [\n    new transports.Console()\n  ],\n});\n\nexport default logger;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"97774e65807e330c7054d232ab58a545f3679ecf"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/middleware/index.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/middleware/index.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":7,"column":0},"end":{"line":7,"column":28}}},"fnMap":{"0":{"name":"default_1","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":18}},"loc":{"start":{"line":5,"column":24},"end":{"line":6,"column":1}},"line":5}},"branchMap":{},"s":{"0":1,"1":1},"f":{"0":1},"b":{},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/middleware/index.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/middleware/index.ts"],"names":[],"mappings":";;AACA,wEAAwE;AAExE,mGAAmG;AACnG,mBAAyB,GAAgB;AACzC,CAAC;AADD,4BACC","sourcesContent":["import { Application } from '../declarations';\n// Don't remove this comment. It's needed to format import lines nicely.\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars, @typescript-eslint/no-empty-function\nexport default function (app: Application): void {\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"bfa88d0bce03e91275e9633d8d98e80f9432810f"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/index.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/index.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":28},"end":{"line":6,"column":85}},"4":{"start":{"line":7,"column":24},"end":{"line":7,"column":73}},"5":{"start":{"line":8,"column":25},"end":{"line":8,"column":76}},"6":{"start":{"line":11,"column":4},"end":{"line":11,"column":47}},"7":{"start":{"line":12,"column":4},"end":{"line":12,"column":43}},"8":{"start":{"line":13,"column":4},"end":{"line":13,"column":44}},"9":{"start":{"line":15,"column":0},"end":{"line":15,"column":28}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"default_1","decl":{"start":{"line":10,"column":9},"end":{"line":10,"column":18}},"loc":{"start":{"line":10,"column":24},"end":{"line":14,"column":1}},"line":10}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3}},"s":{"0":1,"1":3,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1},"f":{"0":3,"1":1},"b":{"0":[1,1,1],"1":[3,0],"2":[3,3]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/index.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/index.ts"],"names":[],"mappings":";;;;;AACA,sFAAqD;AACrD,0EAA0C;AAC1C,6EAA6C;AAC7C,wEAAwE;AAExE,mBAAyB,GAAgB;IACvC,GAAG,CAAC,SAAS,CAAC,2BAAQ,CAAC,CAAC;IACxB,GAAG,CAAC,SAAS,CAAC,uBAAK,CAAC,CAAC;IACrB,GAAG,CAAC,SAAS,CAAC,wBAAM,CAAC,CAAC;AACxB,CAAC;AAJD,4BAIC","sourcesContent":["import { Application } from '../declarations';\nimport apiUsers from './api-users/api-users.service';\nimport users from './users/users.service';\nimport events from './events/events.service';\n// Don't remove this comment. It's needed to format import lines nicely.\n\nexport default function (app: Application): void {\n  app.configure(apiUsers);\n  app.configure(users);\n  app.configure(events);\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"088f43e0aa6cf7246dceaa312cdc75a7c83e6e5a"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/api-users/api-users.service.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/api-users/api-users.service.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":26},"end":{"line":6,"column":54}},"4":{"start":{"line":7,"column":26},"end":{"line":7,"column":82}},"5":{"start":{"line":8,"column":26},"end":{"line":8,"column":71}},"6":{"start":{"line":10,"column":20},"end":{"line":13,"column":5}},"7":{"start":{"line":15,"column":4},"end":{"line":15,"column":72}},"8":{"start":{"line":17,"column":20},"end":{"line":17,"column":44}},"9":{"start":{"line":18,"column":4},"end":{"line":18,"column":45}},"10":{"start":{"line":20,"column":0},"end":{"line":20,"column":28}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"default_1","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":18}},"loc":{"start":{"line":9,"column":24},"end":{"line":19,"column":1}},"line":9}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3}},"s":{"0":1,"1":2,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1},"f":{"0":2,"1":1},"b":{"0":[1,1,1],"1":[2,0],"2":[2,2]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/api-users/api-users.service.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/api-users/api-users.service.ts"],"names":[],"mappings":";;;;;AAGA,uDAA6C;AAC7C,mFAAuD;AACvD,wEAAsC;AAStC,mBAAyB,GAAgB;IACvC,MAAM,OAAO,GAAG;QACd,KAAK,EAAE,yBAAW,CAAC,GAAG,CAAC;QACvB,QAAQ,EAAE,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC;KAC9B,CAAC;IAEF,sDAAsD;IACtD,GAAG,CAAC,GAAG,CAAC,YAAY,EAAE,IAAI,0BAAQ,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAC;IAElD,4DAA4D;IAC5D,MAAM,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;IAEzC,OAAO,CAAC,KAAK,CAAC,yBAAK,CAAC,CAAC;AACvB,CAAC;AAbD,4BAaC","sourcesContent":["// Initializes the `api-users` service on path `/api-users`\nimport { ServiceAddons } from '@feathersjs/feathers';\nimport { Application } from '../../declarations';\nimport { ApiUsers } from './api-users.class';\nimport createModel from '../../models/api-users.model';\nimport hooks from './api-users.hooks';\n\n// Add this service to the service type index\ndeclare module '../../declarations' {\n  interface ServiceTypes {\n    'api-users': ApiUsers & ServiceAddons<any>;\n  }\n}\n\nexport default function (app: Application): void {\n  const options = {\n    Model: createModel(app),\n    paginate: app.get('paginate')\n  };\n\n  // Initialize our service with any options it requires\n  app.use('/api-users', new ApiUsers(options, app));\n\n  // Get our initialized service so that we can register hooks\n  const service = app.service('api-users');\n\n  service.hooks(hooks);\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"39933e6248df05afe6015624e09b659180da9958"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/api-users/api-users.class.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/api-users/api-users.class.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":26}},"2":{"start":{"line":4,"column":29},"end":{"line":4,"column":58}},"3":{"start":{"line":9,"column":8},"end":{"line":9,"column":23}},"4":{"start":{"line":12,"column":0},"end":{"line":12,"column":28}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":8,"column":4},"end":{"line":8,"column":5}},"loc":{"start":{"line":8,"column":30},"end":{"line":10,"column":5}},"line":8}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1},"f":{"0":1},"b":{},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/api-users/api-users.class.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/api-users/api-users.class.ts"],"names":[],"mappings":";;;AAAA,2DAAsE;AAItE,6EAA6E;AAC7E,MAAa,QAAS,SAAQ,4BAAO;IACnC,4DAA4D;IAC5D,YAAY,OAAyC,EAAE,GAAgB;QACrE,KAAK,CAAC,OAAO,CAAC,CAAC;IACjB,CAAC;CACF;AALD,4BAKC","sourcesContent":["import { Service, SequelizeServiceOptions } from 'feathers-sequelize';\nimport { Application } from '../../declarations';\n\n\n// This class if for authentication service on top of the API via JWT Tokens \nexport class ApiUsers extends Service {\n  //eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(options: Partial<SequelizeServiceOptions>, app: Application) {\n    super(options);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ea49fd3f9115af22ac4ecf8cc4765ab9ae8a7b20"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/models/api-users.model.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/models/api-users.model.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":5,"column":20},"end":{"line":5,"column":40}},"2":{"start":{"line":7,"column":28},"end":{"line":7,"column":54}},"3":{"start":{"line":8,"column":21},"end":{"line":43,"column":6}},"4":{"start":{"line":40,"column":16},"end":{"line":40,"column":35}},"5":{"start":{"line":45,"column":4},"end":{"line":48,"column":6}},"6":{"start":{"line":49,"column":4},"end":{"line":49,"column":20}},"7":{"start":{"line":51,"column":0},"end":{"line":51,"column":28}}},"fnMap":{"0":{"name":"default_1","decl":{"start":{"line":6,"column":9},"end":{"line":6,"column":18}},"loc":{"start":{"line":6,"column":24},"end":{"line":50,"column":1}},"line":6},"1":{"name":"(anonymous_1)","decl":{"start":{"line":39,"column":12},"end":{"line":39,"column":13}},"loc":{"start":{"line":39,"column":33},"end":{"line":41,"column":13}},"line":39},"2":{"name":"(anonymous_2)","decl":{"start":{"line":45,"column":25},"end":{"line":45,"column":26}},"loc":{"start":{"line":45,"column":43},"end":{"line":48,"column":5}},"line":45}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"f":{"0":1,"1":1,"2":1},"b":{},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/models/api-users.model.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/models/api-users.model.ts"],"names":[],"mappings":";;AAAA,oEAAoE;AACpE,oCAAoC;AACpC,yCAAwD;AAIxD,mBAAyB,GAAgB;IACvC,MAAM,eAAe,GAAc,GAAG,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;IAC9D,MAAM,QAAQ,GAAG,eAAe,CAAC,MAAM,CAAC,WAAW,EAAE;QACnD,EAAE,EAAE;YACF,IAAI,EAAE,qBAAS,CAAC,OAAO;YACvB,UAAU,EAAE,IAAI;YAChB,aAAa,EAAE,IAAI;YACnB,SAAS,EAAE,KAAK;SACjB;QACD,KAAK,EAAE;YACL,IAAI,EAAE,qBAAS,CAAC,MAAM;YACtB,SAAS,EAAE,KAAK;YAChB,MAAM,EAAE,IAAI;YACZ,QAAQ,EAAE;gBACR,OAAO,EAAE;oBACP,GAAG,EAAE,sBAAsB;iBAC5B;gBACD,OAAO,EAAE;oBACP,GAAG,EAAE,wBAAwB;iBAC9B;aACF;SACF;QACD,QAAQ,EAAE;YACR,IAAI,EAAE,qBAAS,CAAC,MAAM;YACtB,SAAS,EAAE,KAAK;YAChB,QAAQ,EAAE;gBACR,OAAO,EAAE;oBACP,GAAG,EAAE,2BAA2B;iBACjC;aACF;SACF;KAEF,EAAE;QACD,KAAK,EAAE;YACL,WAAW,CAAC,OAAY;gBACtB,OAAO,CAAC,GAAG,GAAG,IAAI,CAAC;YACrB,CAAC;SACF;KACF,CAAC,CAAC;IAEH,6DAA6D;IAC5D,QAAgB,CAAC,SAAS,GAAG,UAAU,MAAW;QACjD,2BAA2B;QAC3B,+DAA+D;IACjE,CAAC,CAAC;IAEF,OAAO,QAAQ,CAAC;AAClB,CAAC;AA/CD,4BA+CC","sourcesContent":["// See http://docs.sequelizejs.com/en/latest/docs/models-definition/\n// for more of what you can do here.\nimport { Sequelize, DataTypes, Model } from 'sequelize';\nimport { Application } from '../declarations';\nimport { HookReturn } from 'sequelize/types/lib/hooks';\n\nexport default function (app: Application): typeof Model {\n  const sequelizeClient: Sequelize = app.get('sequelizeClient');\n  const apiUsers = sequelizeClient.define('api_users', {\n    id: {\n      type: DataTypes.INTEGER,\n      primaryKey: true,\n      autoIncrement: true,\n      allowNull: false\n    },\n    email: {\n      type: DataTypes.STRING,\n      allowNull: false,\n      unique: true,\n      validate: {\n        isEmail: {\n          msg: 'Is not a valid email'\n        },\n        notNull: {\n          msg: 'The email is mandatory'\n        }\n      }\n    },\n    password: {\n      type: DataTypes.STRING,\n      allowNull: false,\n      validate: {\n        notNull: {\n          msg: 'The password is mandatory'\n        }\n      }\n    }\n  \n  }, {\n    hooks: {\n      beforeCount(options: any): HookReturn {\n        options.raw = true;\n      }\n    }\n  });\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  (apiUsers as any).associate = function (models: any): void {\n    // Define associations here\n    // See http://docs.sequelizejs.com/en/latest/docs/associations/\n  };\n\n  return apiUsers;\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f8e659839ac621de4d222bca93bad2520dbcab3c"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/api-users/api-users.hooks.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/api-users/api-users.hooks.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":8,"column":3}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"2":{"start":{"line":3,"column":26},"end":{"line":3,"column":33}},"3":{"start":{"line":4,"column":4},"end":{"line":4,"column":89}},"4":{"start":{"line":4,"column":71},"end":{"line":4,"column":83}},"5":{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},"6":{"start":{"line":6,"column":26},"end":{"line":6,"column":33}},"7":{"start":{"line":7,"column":4},"end":{"line":7,"column":17}},"8":{"start":{"line":9,"column":25},"end":{"line":13,"column":2}},"9":{"start":{"line":10,"column":4},"end":{"line":10,"column":72}},"10":{"start":{"line":12,"column":4},"end":{"line":12,"column":21}},"11":{"start":{"line":14,"column":19},"end":{"line":20,"column":1}},"12":{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},"13":{"start":{"line":15,"column":31},"end":{"line":15,"column":42}},"14":{"start":{"line":16,"column":17},"end":{"line":16,"column":19}},"15":{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},"16":{"start":{"line":17,"column":21},"end":{"line":17,"column":141}},"17":{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},"18":{"start":{"line":17,"column":109},"end":{"line":17,"column":141}},"19":{"start":{"line":18,"column":4},"end":{"line":18,"column":36}},"20":{"start":{"line":19,"column":4},"end":{"line":19,"column":18}},"21":{"start":{"line":21,"column":0},"end":{"line":21,"column":62}},"22":{"start":{"line":22,"column":31},"end":{"line":22,"column":82}},"23":{"start":{"line":23,"column":14},"end":{"line":23,"column":71}},"24":{"start":{"line":25,"column":25},"end":{"line":25,"column":53}},"25":{"start":{"line":26,"column":34},"end":{"line":26,"column":45}},"26":{"start":{"line":27,"column":0},"end":{"line":59,"column":2}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":74},"end":{"line":2,"column":75}},"loc":{"start":{"line":2,"column":96},"end":{"line":5,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":4,"column":58},"end":{"line":4,"column":59}},"loc":{"start":{"line":4,"column":69},"end":{"line":4,"column":85}},"line":4},"2":{"name":"(anonymous_2)","decl":{"start":{"line":5,"column":6},"end":{"line":5,"column":7}},"loc":{"start":{"line":5,"column":28},"end":{"line":8,"column":1}},"line":5},"3":{"name":"(anonymous_3)","decl":{"start":{"line":9,"column":80},"end":{"line":9,"column":81}},"loc":{"start":{"line":9,"column":95},"end":{"line":11,"column":1}},"line":9},"4":{"name":"(anonymous_4)","decl":{"start":{"line":11,"column":5},"end":{"line":11,"column":6}},"loc":{"start":{"line":11,"column":20},"end":{"line":13,"column":1}},"line":11},"5":{"name":"(anonymous_5)","decl":{"start":{"line":14,"column":50},"end":{"line":14,"column":51}},"loc":{"start":{"line":14,"column":65},"end":{"line":20,"column":1}},"line":14}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":8,"column":3}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":57},"end":{"line":8,"column":2}}],"line":2},"1":{"loc":{"start":{"line":2,"column":57},"end":{"line":8,"column":2}},"type":"cond-expr","locations":[{"start":{"line":2,"column":74},"end":{"line":5,"column":1}},{"start":{"line":5,"column":6},"end":{"line":8,"column":1}}],"line":2},"2":{"loc":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"type":"if","locations":[{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},{"start":{"line":3,"column":4},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},"type":"if","locations":[{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},{"start":{"line":6,"column":4},"end":{"line":6,"column":33}}],"line":6},"4":{"loc":{"start":{"line":9,"column":25},"end":{"line":13,"column":2}},"type":"binary-expr","locations":[{"start":{"line":9,"column":26},"end":{"line":9,"column":30}},{"start":{"line":9,"column":34},"end":{"line":9,"column":57}},{"start":{"line":9,"column":63},"end":{"line":13,"column":1}}],"line":9},"5":{"loc":{"start":{"line":9,"column":63},"end":{"line":13,"column":1}},"type":"cond-expr","locations":[{"start":{"line":9,"column":80},"end":{"line":11,"column":1}},{"start":{"line":11,"column":5},"end":{"line":13,"column":1}}],"line":9},"6":{"loc":{"start":{"line":14,"column":19},"end":{"line":20,"column":1}},"type":"binary-expr","locations":[{"start":{"line":14,"column":20},"end":{"line":14,"column":24}},{"start":{"line":14,"column":28},"end":{"line":14,"column":45}},{"start":{"line":14,"column":50},"end":{"line":20,"column":1}}],"line":14},"7":{"loc":{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},"type":"if","locations":[{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},{"start":{"line":15,"column":4},"end":{"line":15,"column":42}}],"line":15},"8":{"loc":{"start":{"line":15,"column":8},"end":{"line":15,"column":29}},"type":"binary-expr","locations":[{"start":{"line":15,"column":8},"end":{"line":15,"column":11}},{"start":{"line":15,"column":15},"end":{"line":15,"column":29}}],"line":15},"9":{"loc":{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},"type":"if","locations":[{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},{"start":{"line":17,"column":4},"end":{"line":17,"column":141}}],"line":17},"10":{"loc":{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},"type":"if","locations":[{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},{"start":{"line":17,"column":40},"end":{"line":17,"column":141}}],"line":17},"11":{"loc":{"start":{"line":17,"column":44},"end":{"line":17,"column":107}},"type":"binary-expr","locations":[{"start":{"line":17,"column":44},"end":{"line":17,"column":59}},{"start":{"line":17,"column":63},"end":{"line":17,"column":107}}],"line":17}},"s":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":1,"9":0,"10":0,"11":1,"12":2,"13":2,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1},"f":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":2},"b":{"0":[1,1,1],"1":[1,0],"2":[0,0],"3":[0,0],"4":[1,1,1],"5":[1,0],"6":[1,1,1],"7":[2,0],"8":[2,2],"9":[0,0],"10":[0,0],"11":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/api-users/api-users.hooks.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/api-users/api-users.hooks.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA,mFAAqE;AACrE,wEAA0D;AAC1D,wEAAwE;AAExE,MAAM,EAAE,YAAY,EAAE,GAAG,sBAAsB,CAAC,KAAK,CAAC;AACtD,MAAM,EAAE,YAAY,EAAE,OAAO,EAAE,GAAG,KAAK,CAAC,KAAK,CAAC;AAG9C,kBAAe;IACb,MAAM,EAAE;QACN,GAAG,EAAE,EAAE;QACP,IAAI,EAAE,CAAE,YAAY,CAAC,KAAK,CAAC,CAAE;QAC7B,GAAG,EAAE,CAAE,YAAY,CAAC,KAAK,CAAC,CAAE;QAC5B,MAAM,EAAE,CAAE,YAAY,CAAC,UAAU,CAAC,CAAE;QACpC,MAAM,EAAE,CAAE,YAAY,CAAC,UAAU,CAAC,EAAG,YAAY,CAAC,KAAK,CAAC,CAAE;QAC1D,KAAK,EAAE,CAAE,YAAY,CAAC,UAAU,CAAC,EAAG,YAAY,CAAC,KAAK,CAAC,CAAE;QACzD,MAAM,EAAE,CAAE,YAAY,CAAC,KAAK,CAAC,CAAE;KAChC;IAED,KAAK,EAAE;QACL,GAAG,EAAE;YACH,2DAA2D;YAC3D,+BAA+B;YAC/B,OAAO,CAAC,UAAU,CAAC;SACpB;QACD,IAAI,EAAE,EAAE;QACR,GAAG,EAAE,EAAE;QACP,MAAM,EAAE,EAAE;QACV,MAAM,EAAE,EAAE;QACV,KAAK,EAAE,EAAE;QACT,MAAM,EAAE,EAAE;KACX;IAED,KAAK,EAAE;QACL,GAAG,EAAE,EAAE;QACP,IAAI,EAAE,EAAE;QACR,GAAG,EAAE,EAAE;QACP,MAAM,EAAE,EAAE;QACV,MAAM,EAAE,EAAE;QACV,KAAK,EAAE,EAAE;QACT,MAAM,EAAE,EAAE;KACX;CACF,CAAC","sourcesContent":["import * as feathersAuthentication from '@feathersjs/authentication';\nimport * as local from '@feathersjs/authentication-local';\n// Don't remove this comment. It's needed to format import lines nicely.\n\nconst { authenticate } = feathersAuthentication.hooks;\nconst { hashPassword, protect } = local.hooks;\n\n\nexport default {\n  before: {\n    all: [],\n    find: [ authenticate('jwt') ],\n    get: [ authenticate('jwt') ],\n    create: [ hashPassword('password') ],\n    update: [ hashPassword('password'),  authenticate('jwt') ],\n    patch: [ hashPassword('password'),  authenticate('jwt') ],\n    remove: [ authenticate('jwt') ]\n  },\n\n  after: {\n    all: [ \n      // Make sure the password field is never sent to the client\n      // Always must be the last hook\n      protect('password')\n    ],\n    find: [],\n    get: [],\n    create: [],\n    update: [],\n    patch: [],\n    remove: []\n  },\n\n  error: {\n    all: [],\n    find: [],\n    get: [],\n    create: [],\n    update: [],\n    patch: [],\n    remove: []\n  }\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"618e6a925d4219808882f95c201ee30f8ce894b3"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.service.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.service.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":22},"end":{"line":6,"column":46}},"4":{"start":{"line":7,"column":22},"end":{"line":7,"column":74}},"5":{"start":{"line":8,"column":22},"end":{"line":8,"column":63}},"6":{"start":{"line":9,"column":30},"end":{"line":9,"column":76}},"7":{"start":{"line":10,"column":30},"end":{"line":10,"column":93}},"8":{"start":{"line":12,"column":20},"end":{"line":15,"column":5}},"9":{"start":{"line":17,"column":4},"end":{"line":17,"column":61}},"10":{"start":{"line":19,"column":4},"end":{"line":19,"column":84}},"11":{"start":{"line":21,"column":20},"end":{"line":21,"column":40}},"12":{"start":{"line":23,"column":27},"end":{"line":23,"column":55}},"13":{"start":{"line":24,"column":4},"end":{"line":24,"column":41}},"14":{"start":{"line":25,"column":4},"end":{"line":25,"column":56}},"15":{"start":{"line":27,"column":0},"end":{"line":27,"column":28}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"default_1","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":18}},"loc":{"start":{"line":11,"column":24},"end":{"line":26,"column":1}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3}},"s":{"0":1,"1":3,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1},"f":{"0":3,"1":1},"b":{"0":[1,1,1],"1":[3,0],"2":[3,3]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.service.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.service.ts"],"names":[],"mappings":";;;;;AAGA,+CAAsC;AACtC,2EAAmD;AACnD,gEAAkC;AAClC,6EAAmE;AACnE,8FAA6D;AAU7D,mBAAyB,GAAgB;IACvC,MAAM,OAAO,GAAG;QACd,KAAK,EAAE,qBAAW,CAAC,GAAG,CAAC;QACvB,QAAQ,EAAE,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC;KAC9B,CAAC;IAEF,sDAAsD;IACtD,GAAG,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,mBAAK,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAC;IAG3C,sDAAsD;IACtD,GAAG,CAAC,GAAG,CAAC,gBAAgB,EAAE,IAAI,kCAAY,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAC;IAE1D,4DAA4D;IAC5D,MAAM,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;IAErC,4DAA4D;IAC5D,MAAM,cAAc,GAAG,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;IAEpD,OAAO,CAAC,KAAK,CAAC,qBAAK,CAAC,CAAC;IAErB,cAAc,CAAC,KAAK,CAAC,6BAAU,CAAC,CAAC;AAGnC,CAAC;AAxBD,4BAwBC","sourcesContent":["// Initializes the `users` service on path `/users`\nimport { ServiceAddons } from '@feathersjs/feathers';\nimport { Application } from '../../declarations';\nimport { Users } from './users.class';\nimport createModel from '../../models/users.model';\nimport hooks from './users.hooks';\nimport { UsersHistory } from './users.history/users.history.class';\nimport usersHooks from './users.history/users.history.hooks';\n\n// Add this service to the service type index\ndeclare module '../../declarations' { \n  interface ServiceTypes {\n    'users': Users & ServiceAddons<any>;\n    'users-history': UsersHistory & ServiceAddons<any>;\n  }\n}\n\nexport default function (app: Application): void {\n  const options = {\n    Model: createModel(app),\n    paginate: app.get('paginate')\n  };\n\n  // Initialize our service with any options it requires\n  app.use('/users', new Users(options, app));\n\n\n  // Initialize our service with any options it requires\n  app.use('/users-history', new UsersHistory(options, app));\n\n  // Get our initialized service so that we can register hooks\n  const service = app.service('users');\n\n  // Get our initialized service so that we can register hooks\n  const historyService = app.service('users-history');\n\n  service.hooks(hooks);\n\n  historyService.hooks(usersHooks);\n\n  \n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c6c552e416ee7af28b5a29ee1c509a43ab16c8f0"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.class.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.class.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":23}},"4":{"start":{"line":7,"column":29},"end":{"line":7,"column":58}},"5":{"start":{"line":8,"column":14},"end":{"line":8,"column":51}},"6":{"start":{"line":9,"column":20},"end":{"line":9,"column":40}},"7":{"start":{"line":13,"column":8},"end":{"line":13,"column":23}},"8":{"start":{"line":61,"column":8},"end":{"line":70,"column":11}},"9":{"start":{"line":65,"column":12},"end":{"line":67,"column":15}},"10":{"start":{"line":66,"column":16},"end":{"line":66,"column":91}},"11":{"start":{"line":69,"column":12},"end":{"line":69,"column":92}},"12":{"start":{"line":73,"column":0},"end":{"line":73,"column":22}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":4},"end":{"line":12,"column":5}},"loc":{"start":{"line":12,"column":30},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":60,"column":4},"end":{"line":60,"column":5}},"loc":{"start":{"line":60,"column":40},"end":{"line":71,"column":5}},"line":60},"3":{"name":"(anonymous_3)","decl":{"start":{"line":64,"column":16},"end":{"line":64,"column":17}},"loc":{"start":{"line":64,"column":28},"end":{"line":70,"column":9}},"line":64},"4":{"name":"(anonymous_4)","decl":{"start":{"line":65,"column":27},"end":{"line":65,"column":28}},"loc":{"start":{"line":65,"column":40},"end":{"line":67,"column":13}},"line":65}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":66,"column":16},"end":{"line":66,"column":90}},"type":"cond-expr","locations":[{"start":{"line":66,"column":42},"end":{"line":66,"column":65}},{"start":{"line":66,"column":68},"end":{"line":66,"column":90}}],"line":66},"4":{"loc":{"start":{"line":69,"column":19},"end":{"line":69,"column":91}},"type":"cond-expr","locations":[{"start":{"line":69,"column":39},"end":{"line":69,"column":82}},{"start":{"line":69,"column":85},"end":{"line":69,"column":91}}],"line":69}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":0,"9":0,"10":0,"11":0,"12":1},"f":{"0":1,"1":1,"2":0,"3":0,"4":0},"b":{"0":[1,1,1],"1":[1,0],"2":[1,1],"3":[0,0],"4":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.class.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.class.ts"],"names":[],"mappings":";;;;;;AAAA,2DAAsE;AAEtE,oDAA4B;AAC5B,yCAAuC;AAGvC,MAAa,KAAM,SAAQ,4BAAO;IAChC,4DAA4D;IAC5D,YAAY,OAAyC,EAAE,GAAgB;QACrE,KAAK,CAAC,OAAO,CAAC,CAAC;IACjB,CAAC;IAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MA4CE;IACF,KAAK,CAAC,mBAAmB,CAAC,QAAc;QAEtC,OAAO,MAAM,aAAG,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC,KAAK,CAC3C,ycAAyc,EACzc;YACE,IAAI,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;YACxB,IAAI,EAAE,sBAAU,CAAC,MAAM;SACxB,CACF,CAAC,IAAI,CAAE,CAAC,MAAW,EAAE,EAAE;YACtB,MAAM,CAAC,OAAO,CAAE,CAAC,OAAY,EAAE,EAAE;gBAC/B,CAAE,OAAO,CAAC,OAAO,KAAK,CAAC,CAAE,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,GAAG,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC;YAC/E,CAAC,CAAC,CAAC;YACH,wEAAwE;YACxE,OAAO,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;QAClF,CAAC,CAAC,CAAC;IACL,CAAC;CAGF;AArED,sBAqEC","sourcesContent":["import { Service, SequelizeServiceOptions } from 'feathers-sequelize';\nimport { Application } from '../../declarations';\nimport app from '../../app';\nimport { QueryTypes } from 'sequelize';\nimport { UsersServiceInterface } from './users.service.interface';\n\nexport class Users extends Service implements UsersServiceInterface {\n  //eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(options: Partial<SequelizeServiceOptions>, app: Application) {\n    super(options);\n  }\n\n  /*\n    The SQL request below is a reflexive query on 'events' table.\n    I've used it in the function below to obtain a user 'consent state' by fetching the history of events registered \n    for the user whose userUuid is passed as function parameter. The list returned is ordered by the column 'created_at'\n    \n    => The custom field 'history_start_at' in my request will contain a number.\n       This field is used for the '/users-history' custom service, in the second method below 'getUserConsentStateHistory()'.\n       The 'history_start_at' value is a number that will be used at the Users Hook layer to define the limit of number of events to display to API client \n       when don't want to display all the events history of a user (this is the default behaviour according to the exercice). \n       This history_start_at also represent the number of 'type of consent' that has been registered for the current user.\n\n       E.g : The history_start_at value will be 2 if the userUuid is related to 2 'types of consent' (email_notification, sms_notification)\n       This enables in the future, the possibility to add new type of consent like 'phone_call_notification' without changing the code at this software layer\n\n    <<\n        SELECT \n            e1.consent_label as id, \n            e1.consent_decision as enabled,\n            (\n              SELECT COUNT(*)\n              FROM (\n                    SELECT * FROM events ev\n                    WHERE ev.user_uuid = $uuid\n                    GROUP BY ev.consent_label\n                   ) \n                   sub_events\n            ) as history_start_at\n        FROM events e1 \n        WHERE e1.user_uuid = $uuid\n        AND e1.created_at = (\n                              SELECT MAX(e2.created_at) \n                              FROM events e2 \n                              WHERE e2.user_uuid = e1.user_uuid \n                              AND e2.consent_label = e1.consent_label \n                              AND e2.consent_decision = e1.consent_decision\n                            ) \n        ORDER BY e1.created_at DESC                              \n    >>\n\n    I notice that when a field is defined as boolean in the Sequelise Model, \n    Postgres creates a 'boolean' field (true or false values) while MySQL creates a 'Tinyint' fields (0 or 1 values))\n    I formated the 'consent_decision' filed after the SQL request to prepare the result in the format wanted \n    by the API client : 'true or false' inside of '0 or 1', regardless of the database used\n            \n  */     \n  async getUserConsentState(userUUID : any) : Promise<any | any[]> {\n\n    return await app.get('sequelizeClient').query(\n      'SELECT e1.consent_label as id, e1.consent_decision as enabled, ( SELECT COUNT(*) FROM ( SELECT * FROM events ev WHERE ev.user_uuid = $uuid GROUP BY ev.consent_label )  sub_events ) as history_start_at FROM events e1 WHERE e1.user_uuid = $uuid AND e1.created_at = ( SELECT MAX(e2.created_at) FROM events e2 WHERE e2.user_uuid = e1.user_uuid AND e2.consent_label = e1.consent_label AND e2.consent_decision = e1.consent_decision ) ORDER BY e1.created_at DESC',      \n      {\n        bind: { uuid: userUUID },\n        type: QueryTypes.SELECT\n      }\n    ).then( (result: any) => {\n      result.forEach( (consent: any) => {\n        ( consent.enabled === 0 ) ? consent.enabled = false : consent.enabled = true;\n      });\n      // return the consent state of the user that includes his events history\n      return result.length > 0 ? result.slice(0, result[0].history_start_at) : result;\n    });\n  } \n\n  // end of class\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"719eebbe71345553578fa343f7a779fd625b9970"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/models/users.model.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/models/users.model.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":5,"column":20},"end":{"line":5,"column":40}},"2":{"start":{"line":7,"column":28},"end":{"line":7,"column":54}},"3":{"start":{"line":8,"column":18},"end":{"line":38,"column":6}},"4":{"start":{"line":35,"column":16},"end":{"line":35,"column":35}},"5":{"start":{"line":40,"column":4},"end":{"line":50,"column":6}},"6":{"start":{"line":42,"column":8},"end":{"line":49,"column":11}},"7":{"start":{"line":51,"column":4},"end":{"line":51,"column":17}},"8":{"start":{"line":53,"column":0},"end":{"line":53,"column":28}}},"fnMap":{"0":{"name":"default_1","decl":{"start":{"line":6,"column":9},"end":{"line":6,"column":18}},"loc":{"start":{"line":6,"column":24},"end":{"line":52,"column":1}},"line":6},"1":{"name":"(anonymous_1)","decl":{"start":{"line":34,"column":12},"end":{"line":34,"column":13}},"loc":{"start":{"line":34,"column":33},"end":{"line":36,"column":13}},"line":34},"2":{"name":"(anonymous_2)","decl":{"start":{"line":40,"column":22},"end":{"line":40,"column":23}},"loc":{"start":{"line":40,"column":34},"end":{"line":50,"column":5}},"line":40}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":0,"5":1,"6":1,"7":1,"8":1},"f":{"0":1,"1":0,"2":1},"b":{},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/models/users.model.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/models/users.model.ts"],"names":[],"mappings":";;AAAA,oEAAoE;AACpE,oCAAoC;AACpC,yCAAwD;AAIxD,mBAAyB,GAAgB;IACvC,MAAM,eAAe,GAAc,GAAG,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;IAC9D,MAAM,KAAK,GAAG,eAAe,CAAC,MAAM,CAAC,OAAO,EAAE;QAC5C,IAAI,EAAE;YACJ,IAAI,EAAE,qBAAS,CAAC,IAAI;YACpB,UAAU,EAAE,IAAI;YAChB,MAAM,EAAE,IAAI;YACZ,SAAS,EAAE,KAAK;YAChB,QAAQ,EAAE;gBACR,MAAM,EAAE,CAAC;aACV;SACF;QACD,KAAK,EAAE;YACL,IAAI,EAAE,qBAAS,CAAC,MAAM;YACtB,SAAS,EAAE,KAAK;YAChB,MAAM,EAAE,IAAI;YACZ,QAAQ,EAAE;gBACR,OAAO,EAAE;oBACP,GAAG,EAAE,sBAAsB;iBAC5B;gBACD,OAAO,EAAE;oBACP,GAAG,EAAE,wBAAwB;iBAC9B;aACF;SACF;QACD,+EAA+E;KAChF,EAAE;QACD,KAAK,EAAE;YACL,WAAW,CAAC,OAAY;gBACtB,OAAO,CAAC,GAAG,GAAG,IAAI,CAAC;YACrB,CAAC;SACF;KACF,CAAC,CAAC;IAEH,6DAA6D;IAC5D,KAAa,CAAC,SAAS,GAAG;QACzB,wBAAwB;QACxB,KAAK,CAAC,OAAO,CAAC,eAAe,CAAC,MAAM,CAAC,MAAM,EAAE;YAC3C,SAAS,EAAE,MAAM;YACjB,UAAU,EAAE;gBACV,IAAI,EAAG,UAAU;gBACjB,SAAS,EAAE,KAAK;aACjB;YACD,QAAQ,EAAE,UAAU;SACrB,CAAC,CAAC;IACL,CAAC,CAAC;IAEF,OAAO,KAAK,CAAC;AACf,CAAC;AAhDD,4BAgDC","sourcesContent":["// See http://docs.sequelizejs.com/en/latest/docs/models-definition/\n// for more of what you can do here.\nimport { Sequelize, DataTypes, Model } from 'sequelize';\nimport { Application } from '../declarations';\nimport { HookReturn } from 'sequelize/types/lib/hooks';\n\nexport default function (app: Application): typeof Model {\n  const sequelizeClient: Sequelize = app.get('sequelizeClient');\n  const users = sequelizeClient.define('users', {\n    uuid: {\n      type: DataTypes.UUID,\n      primaryKey: true,\n      unique: true,\n      allowNull: false,\n      validate: {\n        isUUID: 4\n      }\n    },\n    email: {\n      type: DataTypes.STRING,\n      allowNull: false,\n      unique: true,\n      validate: {\n        isEmail: {\n          msg: 'Is not a valid email'\n        },\n        notNull: {\n          msg: 'The email is mandatory'\n        }\n      }\n    }  \n    //2 fileds will be automatically added by sequelize : createdAt and updatedAt  \n  }, {\n    hooks: {\n      beforeCount(options: any): HookReturn {\n        options.raw = true;\n      }\n    }\n  });\n  \n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  (users as any).associate = function (): void {\n    // Defining associations\n    users.hasMany(sequelizeClient.models.events, {\n      sourceKey: 'uuid',\n      foreignKey: {\n        name : 'userUuid',\n        allowNull: false\n      },\n      onDelete: 'RESTRICT'\n    });\n  };\n  \n  return users;\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"dc5f1720679e5ac148ffeb69f6704e0325bbcf37"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.hooks.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.hooks.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":8,"column":3}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"2":{"start":{"line":3,"column":26},"end":{"line":3,"column":33}},"3":{"start":{"line":4,"column":4},"end":{"line":4,"column":89}},"4":{"start":{"line":4,"column":71},"end":{"line":4,"column":83}},"5":{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},"6":{"start":{"line":6,"column":26},"end":{"line":6,"column":33}},"7":{"start":{"line":7,"column":4},"end":{"line":7,"column":17}},"8":{"start":{"line":9,"column":25},"end":{"line":13,"column":2}},"9":{"start":{"line":10,"column":4},"end":{"line":10,"column":72}},"10":{"start":{"line":12,"column":4},"end":{"line":12,"column":21}},"11":{"start":{"line":14,"column":19},"end":{"line":20,"column":1}},"12":{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},"13":{"start":{"line":15,"column":31},"end":{"line":15,"column":42}},"14":{"start":{"line":16,"column":17},"end":{"line":16,"column":19}},"15":{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},"16":{"start":{"line":17,"column":21},"end":{"line":17,"column":141}},"17":{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},"18":{"start":{"line":17,"column":109},"end":{"line":17,"column":141}},"19":{"start":{"line":18,"column":4},"end":{"line":18,"column":36}},"20":{"start":{"line":19,"column":4},"end":{"line":19,"column":18}},"21":{"start":{"line":21,"column":0},"end":{"line":21,"column":62}},"22":{"start":{"line":22,"column":23},"end":{"line":22,"column":74}},"23":{"start":{"line":23,"column":36},"end":{"line":23,"column":91}},"24":{"start":{"line":24,"column":35},"end":{"line":24,"column":89}},"25":{"start":{"line":25,"column":25},"end":{"line":25,"column":62}},"26":{"start":{"line":28,"column":25},"end":{"line":28,"column":45}},"27":{"start":{"line":33,"column":31},"end":{"line":46,"column":1}},"28":{"start":{"line":34,"column":4},"end":{"line":45,"column":6}},"29":{"start":{"line":35,"column":25},"end":{"line":35,"column":32}},"30":{"start":{"line":37,"column":24},"end":{"line":37,"column":61}},"31":{"start":{"line":39,"column":8},"end":{"line":42,"column":10}},"32":{"start":{"line":44,"column":8},"end":{"line":44,"column":23}},"33":{"start":{"line":51,"column":35},"end":{"line":59,"column":1}},"34":{"start":{"line":52,"column":4},"end":{"line":58,"column":6}},"35":{"start":{"line":53,"column":25},"end":{"line":53,"column":32}},"36":{"start":{"line":54,"column":8},"end":{"line":56,"column":9}},"37":{"start":{"line":55,"column":12},"end":{"line":55,"column":120}},"38":{"start":{"line":57,"column":8},"end":{"line":57,"column":23}},"39":{"start":{"line":64,"column":34},"end":{"line":79,"column":1}},"40":{"start":{"line":65,"column":4},"end":{"line":78,"column":6}},"41":{"start":{"line":67,"column":38},"end":{"line":67,"column":45}},"42":{"start":{"line":69,"column":27},"end":{"line":69,"column":66}},"43":{"start":{"line":70,"column":8},"end":{"line":76,"column":9}},"44":{"start":{"line":71,"column":12},"end":{"line":75,"column":13}},"45":{"start":{"line":72,"column":16},"end":{"line":74,"column":17}},"46":{"start":{"line":72,"column":51},"end":{"line":72,"column":76}},"47":{"start":{"line":73,"column":20},"end":{"line":73,"column":137}},"48":{"start":{"line":77,"column":8},"end":{"line":77,"column":23}},"49":{"start":{"line":84,"column":28},"end":{"line":127,"column":1}},"50":{"start":{"line":85,"column":4},"end":{"line":126,"column":6}},"51":{"start":{"line":87,"column":40},"end":{"line":87,"column":47}},"52":{"start":{"line":89,"column":34},"end":{"line":111,"column":9}},"53":{"start":{"line":92,"column":33},"end":{"line":92,"column":97}},"54":{"start":{"line":94,"column":12},"end":{"line":94,"column":38}},"55":{"start":{"line":95,"column":12},"end":{"line":97,"column":15}},"56":{"start":{"line":96,"column":16},"end":{"line":96,"column":58}},"57":{"start":{"line":100,"column":12},"end":{"line":100,"column":80}},"58":{"start":{"line":101,"column":12},"end":{"line":104,"column":14}},"59":{"start":{"line":106,"column":12},"end":{"line":106,"column":101}},"60":{"start":{"line":108,"column":12},"end":{"line":108,"column":116}},"61":{"start":{"line":108,"column":50},"end":{"line":108,"column":114}},"62":{"start":{"line":110,"column":12},"end":{"line":110,"column":31}},"63":{"start":{"line":112,"column":8},"end":{"line":123,"column":9}},"64":{"start":{"line":113,"column":12},"end":{"line":118,"column":13}},"65":{"start":{"line":114,"column":16},"end":{"line":117,"column":17}},"66":{"start":{"line":116,"column":20},"end":{"line":116,"column":91}},"67":{"start":{"line":122,"column":12},"end":{"line":122,"column":61}},"68":{"start":{"line":125,"column":8},"end":{"line":125,"column":23}},"69":{"start":{"line":128,"column":0},"end":{"line":166,"column":2}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":74},"end":{"line":2,"column":75}},"loc":{"start":{"line":2,"column":96},"end":{"line":5,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":4,"column":58},"end":{"line":4,"column":59}},"loc":{"start":{"line":4,"column":69},"end":{"line":4,"column":85}},"line":4},"2":{"name":"(anonymous_2)","decl":{"start":{"line":5,"column":6},"end":{"line":5,"column":7}},"loc":{"start":{"line":5,"column":28},"end":{"line":8,"column":1}},"line":5},"3":{"name":"(anonymous_3)","decl":{"start":{"line":9,"column":80},"end":{"line":9,"column":81}},"loc":{"start":{"line":9,"column":95},"end":{"line":11,"column":1}},"line":9},"4":{"name":"(anonymous_4)","decl":{"start":{"line":11,"column":5},"end":{"line":11,"column":6}},"loc":{"start":{"line":11,"column":20},"end":{"line":13,"column":1}},"line":11},"5":{"name":"(anonymous_5)","decl":{"start":{"line":14,"column":50},"end":{"line":14,"column":51}},"loc":{"start":{"line":14,"column":65},"end":{"line":20,"column":1}},"line":14},"6":{"name":"(anonymous_6)","decl":{"start":{"line":33,"column":31},"end":{"line":33,"column":32}},"loc":{"start":{"line":33,"column":37},"end":{"line":46,"column":1}},"line":33},"7":{"name":"(anonymous_7)","decl":{"start":{"line":34,"column":11},"end":{"line":34,"column":12}},"loc":{"start":{"line":34,"column":30},"end":{"line":45,"column":5}},"line":34},"8":{"name":"(anonymous_8)","decl":{"start":{"line":51,"column":35},"end":{"line":51,"column":36}},"loc":{"start":{"line":51,"column":41},"end":{"line":59,"column":1}},"line":51},"9":{"name":"(anonymous_9)","decl":{"start":{"line":52,"column":11},"end":{"line":52,"column":12}},"loc":{"start":{"line":52,"column":30},"end":{"line":58,"column":5}},"line":52},"10":{"name":"(anonymous_10)","decl":{"start":{"line":64,"column":34},"end":{"line":64,"column":35}},"loc":{"start":{"line":64,"column":40},"end":{"line":79,"column":1}},"line":64},"11":{"name":"(anonymous_11)","decl":{"start":{"line":65,"column":11},"end":{"line":65,"column":12}},"loc":{"start":{"line":65,"column":30},"end":{"line":78,"column":5}},"line":65},"12":{"name":"(anonymous_12)","decl":{"start":{"line":72,"column":41},"end":{"line":72,"column":42}},"loc":{"start":{"line":72,"column":51},"end":{"line":72,"column":76}},"line":72},"13":{"name":"(anonymous_13)","decl":{"start":{"line":84,"column":28},"end":{"line":84,"column":29}},"loc":{"start":{"line":84,"column":34},"end":{"line":127,"column":1}},"line":84},"14":{"name":"(anonymous_14)","decl":{"start":{"line":85,"column":11},"end":{"line":85,"column":12}},"loc":{"start":{"line":85,"column":30},"end":{"line":126,"column":5}},"line":85},"15":{"name":"(anonymous_15)","decl":{"start":{"line":89,"column":34},"end":{"line":89,"column":35}},"loc":{"start":{"line":89,"column":57},"end":{"line":111,"column":9}},"line":89},"16":{"name":"(anonymous_16)","decl":{"start":{"line":95,"column":33},"end":{"line":95,"column":34}},"loc":{"start":{"line":95,"column":53},"end":{"line":97,"column":13}},"line":95},"17":{"name":"(anonymous_17)","decl":{"start":{"line":108,"column":37},"end":{"line":108,"column":38}},"loc":{"start":{"line":108,"column":50},"end":{"line":108,"column":114}},"line":108}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":8,"column":3}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":57},"end":{"line":8,"column":2}}],"line":2},"1":{"loc":{"start":{"line":2,"column":57},"end":{"line":8,"column":2}},"type":"cond-expr","locations":[{"start":{"line":2,"column":74},"end":{"line":5,"column":1}},{"start":{"line":5,"column":6},"end":{"line":8,"column":1}}],"line":2},"2":{"loc":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"type":"if","locations":[{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},{"start":{"line":3,"column":4},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},"type":"if","locations":[{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},{"start":{"line":6,"column":4},"end":{"line":6,"column":33}}],"line":6},"4":{"loc":{"start":{"line":9,"column":25},"end":{"line":13,"column":2}},"type":"binary-expr","locations":[{"start":{"line":9,"column":26},"end":{"line":9,"column":30}},{"start":{"line":9,"column":34},"end":{"line":9,"column":57}},{"start":{"line":9,"column":63},"end":{"line":13,"column":1}}],"line":9},"5":{"loc":{"start":{"line":9,"column":63},"end":{"line":13,"column":1}},"type":"cond-expr","locations":[{"start":{"line":9,"column":80},"end":{"line":11,"column":1}},{"start":{"line":11,"column":5},"end":{"line":13,"column":1}}],"line":9},"6":{"loc":{"start":{"line":14,"column":19},"end":{"line":20,"column":1}},"type":"binary-expr","locations":[{"start":{"line":14,"column":20},"end":{"line":14,"column":24}},{"start":{"line":14,"column":28},"end":{"line":14,"column":45}},{"start":{"line":14,"column":50},"end":{"line":20,"column":1}}],"line":14},"7":{"loc":{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},"type":"if","locations":[{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},{"start":{"line":15,"column":4},"end":{"line":15,"column":42}}],"line":15},"8":{"loc":{"start":{"line":15,"column":8},"end":{"line":15,"column":29}},"type":"binary-expr","locations":[{"start":{"line":15,"column":8},"end":{"line":15,"column":11}},{"start":{"line":15,"column":15},"end":{"line":15,"column":29}}],"line":15},"9":{"loc":{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},"type":"if","locations":[{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},{"start":{"line":17,"column":4},"end":{"line":17,"column":141}}],"line":17},"10":{"loc":{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},"type":"if","locations":[{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},{"start":{"line":17,"column":40},"end":{"line":17,"column":141}}],"line":17},"11":{"loc":{"start":{"line":17,"column":44},"end":{"line":17,"column":107}},"type":"binary-expr","locations":[{"start":{"line":17,"column":44},"end":{"line":17,"column":59}},{"start":{"line":17,"column":63},"end":{"line":17,"column":107}}],"line":17},"12":{"loc":{"start":{"line":54,"column":8},"end":{"line":56,"column":9}},"type":"if","locations":[{"start":{"line":54,"column":8},"end":{"line":56,"column":9}},{"start":{"line":54,"column":8},"end":{"line":56,"column":9}}],"line":54},"13":{"loc":{"start":{"line":70,"column":8},"end":{"line":76,"column":9}},"type":"if","locations":[{"start":{"line":70,"column":8},"end":{"line":76,"column":9}},{"start":{"line":70,"column":8},"end":{"line":76,"column":9}}],"line":70},"14":{"loc":{"start":{"line":71,"column":12},"end":{"line":75,"column":13}},"type":"if","locations":[{"start":{"line":71,"column":12},"end":{"line":75,"column":13}},{"start":{"line":71,"column":12},"end":{"line":75,"column":13}}],"line":71},"15":{"loc":{"start":{"line":72,"column":16},"end":{"line":74,"column":17}},"type":"if","locations":[{"start":{"line":72,"column":16},"end":{"line":74,"column":17}},{"start":{"line":72,"column":16},"end":{"line":74,"column":17}}],"line":72},"16":{"loc":{"start":{"line":112,"column":8},"end":{"line":123,"column":9}},"type":"if","locations":[{"start":{"line":112,"column":8},"end":{"line":123,"column":9}},{"start":{"line":112,"column":8},"end":{"line":123,"column":9}}],"line":112},"17":{"loc":{"start":{"line":113,"column":12},"end":{"line":118,"column":13}},"type":"if","locations":[{"start":{"line":113,"column":12},"end":{"line":118,"column":13}},{"start":{"line":113,"column":12},"end":{"line":118,"column":13}}],"line":113},"18":{"loc":{"start":{"line":114,"column":16},"end":{"line":117,"column":17}},"type":"if","locations":[{"start":{"line":114,"column":16},"end":{"line":117,"column":17}},{"start":{"line":114,"column":16},"end":{"line":117,"column":17}}],"line":114}},"s":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":1,"9":0,"10":0,"11":1,"12":1,"13":1,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":0,"30":0,"31":0,"32":0,"33":1,"34":3,"35":0,"36":0,"37":0,"38":0,"39":1,"40":3,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":1,"50":1,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":1},"f":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":1,"6":1,"7":0,"8":3,"9":0,"10":3,"11":0,"12":0,"13":1,"14":0,"15":0,"16":0,"17":0},"b":{"0":[1,1,1],"1":[1,0],"2":[0,0],"3":[0,0],"4":[1,1,1],"5":[1,0],"6":[1,1,1],"7":[1,0],"8":[1,1],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.hooks.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.hooks.ts"],"names":[],"mappings":"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","sourcesContent":["import * as authentication from '@feathersjs/authentication';\nimport { HookContext } from '@feathersjs/feathers';\nimport { UserExistingEmail } from '../../errors/users/user.existing.email.error';\nimport { UserInvalidEmail } from '../../errors/users/user.invalid.email.error';\nimport { emailIsValid, generateUserUUIDv1, deleteObjectFields, renameKey } from '../../utils/didomi.jstools';\n//import an utility function from didomi's JS tools\n\n// Don't remove this comment. It's needed to format import lines nicely.\n\nconst { authenticate } = authentication.hooks;\n\n/*\n  An anonymous function that will modify the data in the Hook context in order to add the user's UUID\n  to the User's data to be stored; It will be called before every create request on Users service\n*/\nconst addUUIDFieldOnUserData = () => {\n  return async (context: HookContext) => {\n    const { data } = context;\n    //Generate a v1 UUID to insert in the database\n    const newUUID = generateUserUUIDv1();\n    // Merge the context's data content to include the user's UUID generated by our function\n    context.data = {\n      ...data,\n      'uuid' : newUUID\n    }; \n    //return the context as best practice\n    return context;\n  };\n}; \n\n/*\n  User's email validity control at the business layer. \n  If the email has an invalid email structure then an error is thrown;\n*/\nconst controlsUsersEmailValidity = () => {\n  return async (context: HookContext) => {\n    const { data } = context;\n    if( !emailIsValid(data.email) ) {\n      throw new UserInvalidEmail('The user\\'s email is not a valid email', data.email);\n    }\n    return context;\n  };\n};\n\n/*\n  User's email unicity control at the business layer. \n  If the email already exist then an error is thrown;\n*/\nconst controlsUsersEmailUnicity = () => {\n  return async (context: HookContext) => {\n    //we obtain the app and the user's data from the Hook context\n    const { app, data, params } = context;\n    //We use the user REST service to obtain the list of users in database \n    const listOfUser = await app.service('users').find(params);\n    if(listOfUser.data){\n      if(listOfUser.data.length > 0){\n        if(listOfUser.data.some( (user: any) => user.email === data.email )){\n          throw new UserExistingEmail('This email is already used, please change it.', data.email);\n        }\n      }\n    }\n    return context;\n  };\n}; \n\n/*\n  A function that will build the Outgoing user consent state into the format of this exercice\n  It will be called \"after\" every a User service request to ensure the user is returned in the format needed \n*/\nconst consentStateBuilder =  () => {\n\n  return async (context: HookContext) => {\n    // Get `app`, `method` and `result` from the hook context\n    const { app, method, result } = context;\n    // Function that adds the user consent state on every user returned by the find service of Users REST API\n    const buildConsentState = async (currentUser: any) => {\n      // I get the user consent state by fetching the last event registered for each of his consent \n      // I've designed a specific function for this stuff at the Users Class service Level : getUserConsentState(userUuid)\n      const consentState = await app.service('users').getUserConsentState(currentUser.uuid);\n      // Adding an array of consents to the current User\n      currentUser.consents = [];\n      consentState.forEach( (currentConsent: any) => {\n        currentUser.consents.push(currentConsent);\n      });\n      // Renaming the uuid field of the current User to match the field name to be displayed \n      // and adding it as the first field of the object to return\n      currentUser = renameKey(currentUser, 'uuid', 'id');\n      currentUser = {\n        id: currentUser.id,\n        ...currentUser\n      };\n      // Removing from the current user, fields that should not be displayed\n      currentUser = deleteObjectFields(currentUser, 'createdAt', 'updatedAt');\n      // Removing history_start_at field from user's consents\n      currentUser.consents.map( (consent: any) => deleteObjectFields(consent, 'history_start_at'));\n      //The current user is then returned with his famous consent state (array of his last consents relative to each type of consent (email_notification, sms_notification, ...)))\n      return currentUser;\n    };\n   \n    if (method === 'find') {\n      if(result.data){\n        if(result.data.length > 0){\n          // Map all Users from database to build Users consent state \n          context.result = await Promise.all(result.data.map(buildConsentState));\n        }\n      }\n    } else {\n      //Otherwise just update the single result\n      context.result = await buildConsentState(result);\n    } \n    // We return the hook context\n    return context;\n  };\n\n};\n\n\n\nexport default {\n  before: {\n    all: [ authenticate('jwt') ],\n    find: [],\n    get: [],\n    create: [ \n      addUUIDFieldOnUserData(), \n      controlsUsersEmailValidity(), \n      controlsUsersEmailUnicity() \n    ],\n    update: [\n      controlsUsersEmailValidity(), \n      controlsUsersEmailUnicity() \n    ],\n    patch: [\n      controlsUsersEmailValidity(), \n      controlsUsersEmailUnicity() \n    ],\n    remove: []\n  },\n\n  after: {\n    all: [ consentStateBuilder() ],\n    find: [],\n    get: [],\n    create: [ ],\n    update: [],\n    patch: [],\n    remove: []\n  },\n\n  error: {\n    all: [],\n    find: [],\n    get: [],\n    create: [],\n    update: [],\n    patch: [],\n    remove: []\n  }\n\n};\n\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e0d597b7b5ad64cd060ca3a4c89d978991aeb530"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/users/user.existing.email.error.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/users/user.existing.email.error.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":35}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":46}},"3":{"start":{"line":8,"column":8},"end":{"line":8,"column":82}},"4":{"start":{"line":11,"column":0},"end":{"line":11,"column":46}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":6,"column":4},"end":{"line":6,"column":5}},"loc":{"start":{"line":6,"column":31},"end":{"line":9,"column":5}},"line":6}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":0,"4":1},"f":{"0":0},"b":{},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/users/user.existing.email.error.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/users/user.existing.email.error.ts"],"names":[],"mappings":";;;AAAA,+CAAmD;AAGnD,MAAa,iBAAkB,SAAQ,sBAAa;IAClD,YAAY,OAAe,EAAE,IAAS;QACpC,mEAAmE;QACnE,KAAK,CAAC,OAAO,EAAE,yBAAyB,EAAE,GAAG,EAAE,mBAAmB,EAAE,IAAI,CAAC,CAAC;IAC5E,CAAC;CACF;AALD,8CAKC","sourcesContent":["import { FeathersError } from '@feathersjs/errors';\n\n\nexport class UserExistingEmail extends FeathersError {\n  constructor(message: string, data: any) {\n    // I send a 422 code (Unprocessable) as recommended by the exercice\n    super(message, 'Existing email Exeption', 422, 'UserExistingEmail', data);\n  }\n}\n\n\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"0f62c617908bfdbfeee029b95a666e443a993ad8"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/users/user.invalid.email.error.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/users/user.invalid.email.error.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":34}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":46}},"3":{"start":{"line":8,"column":8},"end":{"line":8,"column":81}},"4":{"start":{"line":11,"column":0},"end":{"line":11,"column":44}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":6,"column":4},"end":{"line":6,"column":5}},"loc":{"start":{"line":6,"column":31},"end":{"line":9,"column":5}},"line":6}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":0,"4":1},"f":{"0":0},"b":{},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/users/user.invalid.email.error.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/users/user.invalid.email.error.ts"],"names":[],"mappings":";;;AAAA,+CAAmD;AAEnD,MAAa,gBAAiB,SAAQ,sBAAa;IACjD,YAAY,OAAe,EAAE,IAAS;QACpC,mEAAmE;QACnE,KAAK,CAAC,OAAO,EAAE,yBAAyB,EAAE,GAAG,EAAE,kBAAkB,EAAE,IAAI,CAAC,CAAC;IAC3E,CAAC;CACF;AALD,4CAKC","sourcesContent":["import { FeathersError } from '@feathersjs/errors';\n\nexport class UserInvalidEmail extends FeathersError {\n  constructor(message: string, data: any) {\n    // I send a 422 code (Unprocessable) as recommended by the exercice\n    super(message, 'Invalid email Exception', 422, 'UserInvalidEmail', data);\n  }\n}\n\n\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4666d2cde4c0a0017ac9b2cca741d9d1e2590877"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/utils/didomi.jstools.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/utils/didomi.jstools.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":161}},"2":{"start":{"line":5,"column":15},"end":{"line":5,"column":30}},"3":{"start":{"line":7,"column":27},"end":{"line":9,"column":1}},"4":{"start":{"line":8,"column":4},"end":{"line":8,"column":23}},"5":{"start":{"line":10,"column":0},"end":{"line":10,"column":48}},"6":{"start":{"line":12,"column":21},"end":{"line":14,"column":1}},"7":{"start":{"line":13,"column":4},"end":{"line":13,"column":100}},"8":{"start":{"line":15,"column":0},"end":{"line":15,"column":36}},"9":{"start":{"line":17,"column":22},"end":{"line":21,"column":1}},"10":{"start":{"line":18,"column":17},"end":{"line":18,"column":91}},"11":{"start":{"line":19,"column":17},"end":{"line":19,"column":87}},"12":{"start":{"line":20,"column":4},"end":{"line":20,"column":29}},"13":{"start":{"line":22,"column":0},"end":{"line":22,"column":38}},"14":{"start":{"line":24,"column":18},"end":{"line":28,"column":1}},"15":{"start":{"line":25,"column":4},"end":{"line":25,"column":32}},"16":{"start":{"line":26,"column":4},"end":{"line":26,"column":24}},"17":{"start":{"line":27,"column":4},"end":{"line":27,"column":15}},"18":{"start":{"line":29,"column":0},"end":{"line":29,"column":30}},"19":{"start":{"line":31,"column":27},"end":{"line":37,"column":1}},"20":{"start":{"line":32,"column":4},"end":{"line":35,"column":7}},"21":{"start":{"line":33,"column":8},"end":{"line":33,"column":25}},"22":{"start":{"line":36,"column":4},"end":{"line":36,"column":15}},"23":{"start":{"line":38,"column":0},"end":{"line":38,"column":48}},"24":{"start":{"line":40,"column":27},"end":{"line":47,"column":1}},"25":{"start":{"line":41,"column":4},"end":{"line":45,"column":7}},"26":{"start":{"line":42,"column":8},"end":{"line":44,"column":9}},"27":{"start":{"line":42,"column":46},"end":{"line":42,"column":58}},"28":{"start":{"line":43,"column":12},"end":{"line":43,"column":28}},"29":{"start":{"line":46,"column":4},"end":{"line":46,"column":15}},"30":{"start":{"line":48,"column":0},"end":{"line":48,"column":48}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":27},"end":{"line":7,"column":28}},"loc":{"start":{"line":7,"column":33},"end":{"line":9,"column":1}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":21},"end":{"line":12,"column":22}},"loc":{"start":{"line":12,"column":32},"end":{"line":14,"column":1}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":17,"column":22},"end":{"line":17,"column":23}},"loc":{"start":{"line":17,"column":33},"end":{"line":21,"column":1}},"line":17},"3":{"name":"(anonymous_3)","decl":{"start":{"line":24,"column":18},"end":{"line":24,"column":19}},"loc":{"start":{"line":24,"column":45},"end":{"line":28,"column":1}},"line":24},"4":{"name":"(anonymous_4)","decl":{"start":{"line":31,"column":27},"end":{"line":31,"column":28}},"loc":{"start":{"line":31,"column":58},"end":{"line":37,"column":1}},"line":31},"5":{"name":"(anonymous_5)","decl":{"start":{"line":32,"column":30},"end":{"line":32,"column":31}},"loc":{"start":{"line":32,"column":40},"end":{"line":35,"column":5}},"line":32},"6":{"name":"(anonymous_6)","decl":{"start":{"line":40,"column":27},"end":{"line":40,"column":28}},"loc":{"start":{"line":40,"column":58},"end":{"line":47,"column":1}},"line":40},"7":{"name":"(anonymous_7)","decl":{"start":{"line":41,"column":29},"end":{"line":41,"column":30}},"loc":{"start":{"line":41,"column":38},"end":{"line":45,"column":5}},"line":41},"8":{"name":"(anonymous_8)","decl":{"start":{"line":42,"column":36},"end":{"line":42,"column":37}},"loc":{"start":{"line":42,"column":46},"end":{"line":42,"column":58}},"line":42}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":11},"end":{"line":13,"column":99}},"type":"cond-expr","locations":[{"start":{"line":13,"column":87},"end":{"line":13,"column":91}},{"start":{"line":13,"column":94},"end":{"line":13,"column":99}}],"line":13},"1":{"loc":{"start":{"line":42,"column":8},"end":{"line":44,"column":9}},"type":"if","locations":[{"start":{"line":42,"column":8},"end":{"line":44,"column":9}},{"start":{"line":42,"column":8},"end":{"line":44,"column":9}}],"line":42}},"s":{"0":1,"1":1,"2":1,"3":1,"4":0,"5":1,"6":1,"7":0,"8":1,"9":1,"10":0,"11":0,"12":0,"13":1,"14":1,"15":0,"16":0,"17":0,"18":1,"19":1,"20":0,"21":0,"22":0,"23":1,"24":1,"25":0,"26":0,"27":0,"28":0,"29":0,"30":1},"f":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},"b":{"0":[0,0],"1":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/utils/didomi.jstools.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/utils/didomi.jstools.ts"],"names":[],"mappings":";;;AAAA,kCAAkC;AAClC,+BAAoC;AAEpC,qBAAqB;AACd,MAAM,kBAAkB,GAAG,GAAG,EAAE;IACrC,OAAO,SAAM,EAAE,CAAC;AAClB,CAAC,CAAC;AAFW,QAAA,kBAAkB,sBAE7B;AAEF,6BAA6B;AACtB,MAAM,YAAY,GAAG,CAAC,KAAa,EAAE,EAAE;IAC5C,OAAO,6DAA6D,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAE,IAAI,CAAC,CAAC,CAAE,KAAK,CAAC;AACpG,CAAC,CAAC;AAFW,QAAA,YAAY,gBAEvB;AAEF,iBAAiB;AACV,MAAM,aAAa,GAAG,CAAC,KAAY,EAAE,EAAE;IAC5C,MAAM,IAAI,GAAG,KAAK,CAAC,WAAW,EAAE,GAAC,GAAG,GAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,GAAC,CAAC,CAAC,GAAC,GAAG,GAAC,KAAK,CAAC,OAAO,EAAE,CAAC;IAC9E,MAAM,IAAI,GAAG,KAAK,CAAC,QAAQ,EAAE,GAAG,GAAG,GAAG,KAAK,CAAC,UAAU,EAAE,GAAG,GAAG,GAAG,KAAK,CAAC,UAAU,EAAE,CAAC;IACpF,OAAO,IAAI,GAAC,GAAG,GAAC,IAAI,CAAC;AACvB,CAAC,CAAC;AAJW,QAAA,aAAa,iBAIxB;AAEF,8BAA8B;AACvB,MAAM,SAAS,GAAG,CAAC,GAAS,EAAE,OAAa,EAAE,OAAa,EAAE,EAAE;IACnE,GAAG,CAAC,OAAO,CAAC,GAAG,GAAG,CAAC,OAAO,CAAC,CAAC;IAC5B,OAAO,GAAG,CAAC,OAAO,CAAC,CAAC;IACpB,OAAO,GAAG,CAAC;AACb,CAAC,CAAC;AAJW,QAAA,SAAS,aAIpB;AAEF,8BAA8B;AACvB,MAAM,kBAAkB,GAAG,CAAC,GAAQ,EAAE,GAAG,iBAAyB,EAAE,EAAE;IAC3E,iBAAiB,CAAC,OAAO,CAAE,CAAC,IAAI,EAAE,EAAE;QAClC,OAAO,GAAG,CAAC,IAAI,CAAC,CAAC;QACjB,qBAAqB;IACvB,CAAC,CAAC,CAAC;IACH,OAAO,GAAG,CAAC;AACb,CAAC,CAAC;AANW,QAAA,kBAAkB,sBAM7B;AAEF,oFAAoF;AAC7E,MAAM,kBAAkB,GAAG,CAAC,GAAQ,EAAE,GAAG,iBAAyB,EAAE,EAAE;IAC3E,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,CAAE,CAAC,GAAG,EAAE,EAAE;QAChC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAE,CAAC,IAAY,EAAE,EAAE,CAAC,IAAI,KAAK,GAAG,CAAE,EAAC;YAC5D,OAAO,GAAG,CAAC,GAAG,CAAC,CAAC;SACjB;IACH,CAAC,CAAC,CAAC;IACH,OAAO,GAAG,CAAC;AACb,CAAC,CAAC;AAPW,QAAA,kBAAkB,sBAO7B","sourcesContent":["//import _, { at } from 'lodash'; \nimport { v4 as uuidv1 } from 'uuid';\n\n//Generates a v1 UUID\nexport const generateUserUUIDv1 = () => {\n  return uuidv1();\n};\n\n//Return if an email is valid\nexport const emailIsValid = (email: string) => {\n  return /^([A-Za-z0-9_\\-\\.])+\\@([A-Za-z0-9_\\-\\.])+\\.([A-Za-z]{2,4})$/.test(email) ?  true :  false; \n};\n\n//Format the date\nexport const dateFormatter = (today : Date) => {\n  const date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();\n  const time = today.getHours() + ':' + today.getMinutes() + ':' + today.getSeconds();\n  return date+' '+time; \n};\n\n// rename the key of a object \nexport const renameKey = (obj : any, oldName : any, newName : any) => {     \n  obj[newName] = obj[oldName];\n  delete obj[oldName];  \n  return obj; \n}; \n\n// delete fields in an object \nexport const deleteObjectFields = (obj: any, ...attibutesToDelete : any[]) => {    \n  attibutesToDelete.forEach( (attr) => {\n    delete obj[attr];\n    //_.unset(obj, attr);\n  });\n  return obj;\n}; \n\n// filter fields of an object and delete the filed that aren't in the 2nd parameter \nexport const filterObjectFields = (obj: any, ...attibutesToDelete : any[]) => { \n  Object.keys(obj).forEach( (key) => {\n    if( !attibutesToDelete.some( (attr: string) => attr === key )){\n      delete obj[key];\n    }\n  });\n  return obj;\n}; \n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5a39d0642de2e8163cc41b34216d4fe726fa760d"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.history/users.history.class.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.history/users.history.class.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":30}},"4":{"start":{"line":7,"column":29},"end":{"line":7,"column":58}},"5":{"start":{"line":8,"column":14},"end":{"line":8,"column":54}},"6":{"start":{"line":9,"column":20},"end":{"line":9,"column":40}},"7":{"start":{"line":13,"column":8},"end":{"line":13,"column":23}},"8":{"start":{"line":44,"column":8},"end":{"line":53,"column":11}},"9":{"start":{"line":48,"column":12},"end":{"line":50,"column":15}},"10":{"start":{"line":49,"column":16},"end":{"line":49,"column":91}},"11":{"start":{"line":52,"column":12},"end":{"line":52,"column":26}},"12":{"start":{"line":56,"column":0},"end":{"line":56,"column":36}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":4},"end":{"line":12,"column":5}},"loc":{"start":{"line":12,"column":30},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":43,"column":4},"end":{"line":43,"column":5}},"loc":{"start":{"line":43,"column":47},"end":{"line":54,"column":5}},"line":43},"3":{"name":"(anonymous_3)","decl":{"start":{"line":47,"column":16},"end":{"line":47,"column":17}},"loc":{"start":{"line":47,"column":28},"end":{"line":53,"column":9}},"line":47},"4":{"name":"(anonymous_4)","decl":{"start":{"line":48,"column":27},"end":{"line":48,"column":28}},"loc":{"start":{"line":48,"column":40},"end":{"line":50,"column":13}},"line":48}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":49,"column":16},"end":{"line":49,"column":90}},"type":"cond-expr","locations":[{"start":{"line":49,"column":42},"end":{"line":49,"column":65}},{"start":{"line":49,"column":68},"end":{"line":49,"column":90}}],"line":49}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":0,"9":0,"10":0,"11":0,"12":1},"f":{"0":1,"1":1,"2":0,"3":0,"4":0},"b":{"0":[1,1,1],"1":[1,0],"2":[1,1],"3":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.history/users.history.class.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.history/users.history.class.ts"],"names":[],"mappings":";;;;;;AAAA,2DAAsE;AAEtE,uDAA+B;AAC/B,yCAAuC;AAIvC,MAAa,YAAa,SAAQ,4BAAO;IACvC,4DAA4D;IAC5D,YAAY,OAAyC,EAAE,GAAgB;QACrE,KAAK,CAAC,OAAO,CAAC,CAAC;IACjB,CAAC;IAGD;;;;;;;;;;;;;;;;;;;;;;;;;;;MA2BE;IACF,KAAK,CAAC,0BAA0B,CAAC,QAAc;QAE7C,OAAO,MAAM,aAAG,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC,KAAK,CAC3C,wdAAwd,EACxd;YACE,IAAI,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;YACxB,IAAI,EAAE,sBAAU,CAAC,MAAM;SACxB,CACF,CAAC,IAAI,CAAE,CAAC,MAAW,EAAE,EAAE;YACtB,MAAM,CAAC,OAAO,CAAE,CAAC,OAAY,EAAE,EAAE;gBAC/B,CAAE,OAAO,CAAC,OAAO,KAAK,CAAC,CAAE,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,GAAG,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC;YAC/E,CAAC,CAAC,CAAC;YACH,wEAAwE;YACxE,OAAO,MAAM,CAAC;QAChB,CAAC,CAAC,CAAC;IACL,CAAC;CAGF;AArDD,oCAqDC","sourcesContent":["import { Service, SequelizeServiceOptions } from 'feathers-sequelize';\nimport { Application } from '../../../declarations';\nimport app from '../../../app';\nimport { QueryTypes } from 'sequelize';\nimport { UsersHistoryServiceInterface } from './users.history.interface';\n\n\nexport class UsersHistory extends Service implements UsersHistoryServiceInterface {\n  //eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(options: Partial<SequelizeServiceOptions>, app: Application) {\n    super(options);\n  }\n\n\n  /*\n    The SQL request below is the same as the query explained above but dont include the field 'history_start_at' \n    wich is not necessary here since we dont want to limit the list of user's orderdred events.\n    <<\n        SELECT \n            e1.consent_label as id, \n            e1.consent_decision as enabled,\n            (\n              SELECT COUNT(*)\n              FROM (\n                    SELECT * FROM events ev\n                    WHERE ev.user_uuid = $uuid\n                    GROUP BY ev.consent_label\n                   ) \n                   sub_events\n            ) as history_start_at\n        FROM events e1 \n        WHERE e1.user_uuid = $uuid\n        AND e1.created_at = (\n                              SELECT MAX(e2.created_at) \n                              FROM events e2 \n                              WHERE e2.user_uuid = e1.user_uuid \n                              AND e2.consent_label = e1.consent_label \n                              AND e2.consent_decision = e1.consent_decision\n                            ) \n        ORDER BY e1.created_at DESC                              \n    >>            \n  */\n  async getUserConsentStateHistory(userUUID : any) : Promise<any | any[]> {\n\n    return await app.get('sequelizeClient').query(\n      'SELECT e1.consent_label as id, e1.consent_decision as enabled, e1.created_at, ( SELECT COUNT(*) FROM ( SELECT * FROM events ev WHERE ev.user_uuid = $uuid GROUP BY ev.consent_label )  sub_events ) as history_start_at FROM events e1 WHERE e1.user_uuid = $uuid AND e1.created_at = ( SELECT MAX(e2.created_at) FROM events e2 WHERE e2.user_uuid = e1.user_uuid AND e2.consent_label = e1.consent_label AND e2.consent_decision = e1.consent_decision ) ORDER BY e1.created_at DESC',      \n      {\n        bind: { uuid: userUUID },\n        type: QueryTypes.SELECT\n      }\n    ).then( (result: any) => {\n      result.forEach( (consent: any) => {\n        ( consent.enabled === 0 ) ? consent.enabled = false : consent.enabled = true;\n      });\n      // return the consent state of the user that includes his events history\n      return result;\n    });\n  }   \n\n  // end of class\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"029619d368565750f1f1f8ddb42f5b8a7fd93102"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.history/users.history.hooks.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.history/users.history.hooks.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":8,"column":3}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"2":{"start":{"line":3,"column":26},"end":{"line":3,"column":33}},"3":{"start":{"line":4,"column":4},"end":{"line":4,"column":89}},"4":{"start":{"line":4,"column":71},"end":{"line":4,"column":83}},"5":{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},"6":{"start":{"line":6,"column":26},"end":{"line":6,"column":33}},"7":{"start":{"line":7,"column":4},"end":{"line":7,"column":17}},"8":{"start":{"line":9,"column":25},"end":{"line":13,"column":2}},"9":{"start":{"line":10,"column":4},"end":{"line":10,"column":72}},"10":{"start":{"line":12,"column":4},"end":{"line":12,"column":21}},"11":{"start":{"line":14,"column":19},"end":{"line":20,"column":1}},"12":{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},"13":{"start":{"line":15,"column":31},"end":{"line":15,"column":42}},"14":{"start":{"line":16,"column":17},"end":{"line":16,"column":19}},"15":{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},"16":{"start":{"line":17,"column":21},"end":{"line":17,"column":141}},"17":{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},"18":{"start":{"line":17,"column":109},"end":{"line":17,"column":141}},"19":{"start":{"line":18,"column":4},"end":{"line":18,"column":36}},"20":{"start":{"line":19,"column":4},"end":{"line":19,"column":18}},"21":{"start":{"line":21,"column":0},"end":{"line":21,"column":62}},"22":{"start":{"line":22,"column":23},"end":{"line":22,"column":74}},"23":{"start":{"line":23,"column":42},"end":{"line":23,"column":114}},"24":{"start":{"line":24,"column":25},"end":{"line":24,"column":65}},"25":{"start":{"line":27,"column":25},"end":{"line":27,"column":45}},"26":{"start":{"line":32,"column":29},"end":{"line":40,"column":1}},"27":{"start":{"line":33,"column":4},"end":{"line":39,"column":6}},"28":{"start":{"line":34,"column":33},"end":{"line":34,"column":40}},"29":{"start":{"line":35,"column":8},"end":{"line":37,"column":9}},"30":{"start":{"line":36,"column":12},"end":{"line":36,"column":163}},"31":{"start":{"line":38,"column":8},"end":{"line":38,"column":23}},"32":{"start":{"line":45,"column":28},"end":{"line":93,"column":1}},"33":{"start":{"line":46,"column":4},"end":{"line":92,"column":6}},"34":{"start":{"line":48,"column":40},"end":{"line":48,"column":47}},"35":{"start":{"line":50,"column":34},"end":{"line":77,"column":9}},"36":{"start":{"line":53,"column":33},"end":{"line":53,"column":112}},"37":{"start":{"line":56,"column":12},"end":{"line":58,"column":13}},"38":{"start":{"line":57,"column":16},"end":{"line":57,"column":84}},"39":{"start":{"line":61,"column":12},"end":{"line":61,"column":80}},"40":{"start":{"line":62,"column":12},"end":{"line":65,"column":14}},"41":{"start":{"line":67,"column":12},"end":{"line":67,"column":38}},"42":{"start":{"line":68,"column":12},"end":{"line":70,"column":15}},"43":{"start":{"line":69,"column":16},"end":{"line":69,"column":58}},"44":{"start":{"line":72,"column":12},"end":{"line":72,"column":101}},"45":{"start":{"line":74,"column":12},"end":{"line":74,"column":116}},"46":{"start":{"line":74,"column":50},"end":{"line":74,"column":114}},"47":{"start":{"line":76,"column":12},"end":{"line":76,"column":31}},"48":{"start":{"line":78,"column":8},"end":{"line":89,"column":9}},"49":{"start":{"line":79,"column":12},"end":{"line":84,"column":13}},"50":{"start":{"line":80,"column":16},"end":{"line":83,"column":17}},"51":{"start":{"line":82,"column":20},"end":{"line":82,"column":91}},"52":{"start":{"line":88,"column":12},"end":{"line":88,"column":61}},"53":{"start":{"line":91,"column":8},"end":{"line":91,"column":23}},"54":{"start":{"line":94,"column":0},"end":{"line":122,"column":2}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":74},"end":{"line":2,"column":75}},"loc":{"start":{"line":2,"column":96},"end":{"line":5,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":4,"column":58},"end":{"line":4,"column":59}},"loc":{"start":{"line":4,"column":69},"end":{"line":4,"column":85}},"line":4},"2":{"name":"(anonymous_2)","decl":{"start":{"line":5,"column":6},"end":{"line":5,"column":7}},"loc":{"start":{"line":5,"column":28},"end":{"line":8,"column":1}},"line":5},"3":{"name":"(anonymous_3)","decl":{"start":{"line":9,"column":80},"end":{"line":9,"column":81}},"loc":{"start":{"line":9,"column":95},"end":{"line":11,"column":1}},"line":9},"4":{"name":"(anonymous_4)","decl":{"start":{"line":11,"column":5},"end":{"line":11,"column":6}},"loc":{"start":{"line":11,"column":20},"end":{"line":13,"column":1}},"line":11},"5":{"name":"(anonymous_5)","decl":{"start":{"line":14,"column":50},"end":{"line":14,"column":51}},"loc":{"start":{"line":14,"column":65},"end":{"line":20,"column":1}},"line":14},"6":{"name":"(anonymous_6)","decl":{"start":{"line":32,"column":29},"end":{"line":32,"column":30}},"loc":{"start":{"line":32,"column":35},"end":{"line":40,"column":1}},"line":32},"7":{"name":"(anonymous_7)","decl":{"start":{"line":33,"column":11},"end":{"line":33,"column":12}},"loc":{"start":{"line":33,"column":30},"end":{"line":39,"column":5}},"line":33},"8":{"name":"(anonymous_8)","decl":{"start":{"line":45,"column":28},"end":{"line":45,"column":29}},"loc":{"start":{"line":45,"column":34},"end":{"line":93,"column":1}},"line":45},"9":{"name":"(anonymous_9)","decl":{"start":{"line":46,"column":11},"end":{"line":46,"column":12}},"loc":{"start":{"line":46,"column":30},"end":{"line":92,"column":5}},"line":46},"10":{"name":"(anonymous_10)","decl":{"start":{"line":50,"column":34},"end":{"line":50,"column":35}},"loc":{"start":{"line":50,"column":57},"end":{"line":77,"column":9}},"line":50},"11":{"name":"(anonymous_11)","decl":{"start":{"line":68,"column":33},"end":{"line":68,"column":34}},"loc":{"start":{"line":68,"column":53},"end":{"line":70,"column":13}},"line":68},"12":{"name":"(anonymous_12)","decl":{"start":{"line":74,"column":37},"end":{"line":74,"column":38}},"loc":{"start":{"line":74,"column":50},"end":{"line":74,"column":114}},"line":74}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":8,"column":3}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":57},"end":{"line":8,"column":2}}],"line":2},"1":{"loc":{"start":{"line":2,"column":57},"end":{"line":8,"column":2}},"type":"cond-expr","locations":[{"start":{"line":2,"column":74},"end":{"line":5,"column":1}},{"start":{"line":5,"column":6},"end":{"line":8,"column":1}}],"line":2},"2":{"loc":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"type":"if","locations":[{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},{"start":{"line":3,"column":4},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},"type":"if","locations":[{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},{"start":{"line":6,"column":4},"end":{"line":6,"column":33}}],"line":6},"4":{"loc":{"start":{"line":9,"column":25},"end":{"line":13,"column":2}},"type":"binary-expr","locations":[{"start":{"line":9,"column":26},"end":{"line":9,"column":30}},{"start":{"line":9,"column":34},"end":{"line":9,"column":57}},{"start":{"line":9,"column":63},"end":{"line":13,"column":1}}],"line":9},"5":{"loc":{"start":{"line":9,"column":63},"end":{"line":13,"column":1}},"type":"cond-expr","locations":[{"start":{"line":9,"column":80},"end":{"line":11,"column":1}},{"start":{"line":11,"column":5},"end":{"line":13,"column":1}}],"line":9},"6":{"loc":{"start":{"line":14,"column":19},"end":{"line":20,"column":1}},"type":"binary-expr","locations":[{"start":{"line":14,"column":20},"end":{"line":14,"column":24}},{"start":{"line":14,"column":28},"end":{"line":14,"column":45}},{"start":{"line":14,"column":50},"end":{"line":20,"column":1}}],"line":14},"7":{"loc":{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},"type":"if","locations":[{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},{"start":{"line":15,"column":4},"end":{"line":15,"column":42}}],"line":15},"8":{"loc":{"start":{"line":15,"column":8},"end":{"line":15,"column":29}},"type":"binary-expr","locations":[{"start":{"line":15,"column":8},"end":{"line":15,"column":11}},{"start":{"line":15,"column":15},"end":{"line":15,"column":29}}],"line":15},"9":{"loc":{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},"type":"if","locations":[{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},{"start":{"line":17,"column":4},"end":{"line":17,"column":141}}],"line":17},"10":{"loc":{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},"type":"if","locations":[{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},{"start":{"line":17,"column":40},"end":{"line":17,"column":141}}],"line":17},"11":{"loc":{"start":{"line":17,"column":44},"end":{"line":17,"column":107}},"type":"binary-expr","locations":[{"start":{"line":17,"column":44},"end":{"line":17,"column":59}},{"start":{"line":17,"column":63},"end":{"line":17,"column":107}}],"line":17},"12":{"loc":{"start":{"line":35,"column":8},"end":{"line":37,"column":9}},"type":"if","locations":[{"start":{"line":35,"column":8},"end":{"line":37,"column":9}},{"start":{"line":35,"column":8},"end":{"line":37,"column":9}}],"line":35},"13":{"loc":{"start":{"line":35,"column":12},"end":{"line":35,"column":49}},"type":"binary-expr","locations":[{"start":{"line":35,"column":12},"end":{"line":35,"column":29}},{"start":{"line":35,"column":33},"end":{"line":35,"column":49}}],"line":35},"14":{"loc":{"start":{"line":56,"column":12},"end":{"line":58,"column":13}},"type":"if","locations":[{"start":{"line":56,"column":12},"end":{"line":58,"column":13}},{"start":{"line":56,"column":12},"end":{"line":58,"column":13}}],"line":56},"15":{"loc":{"start":{"line":78,"column":8},"end":{"line":89,"column":9}},"type":"if","locations":[{"start":{"line":78,"column":8},"end":{"line":89,"column":9}},{"start":{"line":78,"column":8},"end":{"line":89,"column":9}}],"line":78},"16":{"loc":{"start":{"line":79,"column":12},"end":{"line":84,"column":13}},"type":"if","locations":[{"start":{"line":79,"column":12},"end":{"line":84,"column":13}},{"start":{"line":79,"column":12},"end":{"line":84,"column":13}}],"line":79},"17":{"loc":{"start":{"line":80,"column":16},"end":{"line":83,"column":17}},"type":"if","locations":[{"start":{"line":80,"column":16},"end":{"line":83,"column":17}},{"start":{"line":80,"column":16},"end":{"line":83,"column":17}}],"line":80}},"s":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":1,"9":0,"10":0,"11":1,"12":1,"13":1,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":0,"29":0,"30":0,"31":0,"32":1,"33":1,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":1},"f":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":1,"6":1,"7":0,"8":1,"9":0,"10":0,"11":0,"12":0},"b":{"0":[1,1,1],"1":[1,0],"2":[0,0],"3":[0,0],"4":[1,1,1],"5":[1,0],"6":[1,1,1],"7":[1,0],"8":[1,1],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.history/users.history.hooks.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/users/users.history/users.history.hooks.ts"],"names":[],"mappings":"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","sourcesContent":["import * as authentication from '@feathersjs/authentication';\nimport { HookContext } from '@feathersjs/feathers';\nimport { UsersHistoryServiceForbidden } from '../../../errors/users/history/users.history.service.forbidden';\nimport { deleteObjectFields, renameKey } from '../../../utils/didomi.jstools';\n//import an utility function from didomi's JS tools\n\n// Don't remove this comment. It's needed to format import lines nicely.\n\nconst { authenticate } = authentication.hooks;\n\n\n/*\n   A method to control every incomming request on User History custom service\n   Will be ran on all incoming request to authorize only get and find requests for events history\n*/\nconst requestAuthorization = () => {\n  return async (context: HookContext) => {\n    const { method, data } = context;\n    if( method !== 'find' && method !== 'get' ) {\n      throw new UsersHistoryServiceForbidden('This service is not authorize on Users events history custom service', data);\n    }\n    return context;\n  };\n};\n\n/*\n  A function that will build the Outgoing user consent state into the format of this exercice\n  It will be called \"after\" every a User service request to ensure the user is returned in the format needed \n*/\nconst consentStateBuilder =  () => {\n\n  return async (context: HookContext) => {\n    // Get `app`, `method` and `result` from the hook context\n    const { app, method, result } = context;\n\n    // Function that adds the user consent state on every user returned by the find service of Users REST API\n    const buildConsentState = async (currentUser: any) => {\n      // I get the user consent state by fetching the last event registered for each of his consent \n      // I've designed a specific function for this stuff at the Users Class service Level : getUserConsentState(userUuid)\n      const consentState = await app.service('users-history').getUserConsentStateHistory(currentUser.uuid);\n\n      // The 'history_start_at' filed is a number, and additional information meaning that : \"all the events starting from that number\n      // are not related to the current state but are related to olds user states\". They are filtered by createdAt DESC.\n      if(consentState.length > 0){\n        currentUser.history_start_at = consentState[0].history_start_at + 1;\n      }\n      // Renaming the uuid field of the current User to match the field name to be displayed \n      // and adding it as the first field of the object to return\n      currentUser = renameKey(currentUser, 'uuid', 'id');\n      currentUser = {\n        id: currentUser.id,\n        ...currentUser\n      };\n      // Adding an array of consents to the current User\n      currentUser.consents = [];\n      consentState.forEach( (currentConsent: any) => {\n        currentUser.consents.push(currentConsent);\n      });\n      // Removing from the current user, fields that should not be displayed\n      currentUser = deleteObjectFields(currentUser, 'createdAt', 'updatedAt');\n      // Removing history_start_at field in consents\n      currentUser.consents.map( (consent: any) => deleteObjectFields(consent, 'history_start_at'));\n\n      //The current user is then returned with his famous consent state (array of his last consents relative to each type of consent (email_notification, sms_notification, ...)))\n      return currentUser;\n    };\n   \n    if (method === 'find') {\n      if(result.data){\n        if(result.data.length > 0){\n          // Map all Users from database to build Users consent state \n          context.result = await Promise.all(result.data.map(buildConsentState));\n        }\n      }\n    } else {\n      //Otherwise just update the single result\n      context.result = await buildConsentState(result);\n    } \n    // We return the hook context\n    return context;\n  };\n\n};\n\n\nexport default {\n  before: {\n    all: [ authenticate('jwt'), requestAuthorization() ],\n    find: [],\n    get: [],\n    create: [],\n    update: [],\n    patch: [],\n    remove: []\n  },\n\n  after: {\n    all: [ consentStateBuilder() ],\n    find: [],\n    get: [],\n    create: [ ],\n    update: [],\n    patch: [],\n    remove: []\n  },\n\n  error: {\n    all: [],\n    find: [],\n    get: [],\n    create: [],\n    update: [],\n    patch: [],\n    remove: []\n  }\n\n};\n\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"006d973812ec0cace9d0eb3f9765c599956780c2"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/users/history/users.history.service.forbidden.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/users/history/users.history.service.forbidden.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":46}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":46}},"3":{"start":{"line":8,"column":8},"end":{"line":8,"column":110}},"4":{"start":{"line":11,"column":0},"end":{"line":11,"column":68}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":6,"column":4},"end":{"line":6,"column":5}},"loc":{"start":{"line":6,"column":31},"end":{"line":9,"column":5}},"line":6}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":0,"4":1},"f":{"0":0},"b":{},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/users/history/users.history.service.forbidden.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/users/history/users.history.service.forbidden.ts"],"names":[],"mappings":";;;AAAA,+CAAmD;AAEnD,MAAa,4BAA6B,SAAQ,sBAAa;IAC7D,YAAY,OAAe,EAAE,IAAS;QACpC,yCAAyC;QACzC,KAAK,CAAC,OAAO,EAAE,0CAA0C,EAAE,GAAG,EAAE,8BAA8B,EAAE,IAAI,CAAC,CAAC;IACxG,CAAC;CACF;AALD,oEAKC","sourcesContent":["import { FeathersError } from '@feathersjs/errors';\n\nexport class UsersHistoryServiceForbidden extends FeathersError {\n  constructor(message: string, data: any) {\n    // I send a 405 code (Method not allowed)\n    super(message, 'Users events history forbidden Exception', 405, 'UsersHistoryServiceForbidden', data);\n  }\n}\n\n\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4731e20e0021a15484b0c6bd150b508095068931"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/events/events.service.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/events/events.service.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":23},"end":{"line":6,"column":48}},"4":{"start":{"line":7,"column":23},"end":{"line":7,"column":76}},"5":{"start":{"line":8,"column":23},"end":{"line":8,"column":65}},"6":{"start":{"line":10,"column":20},"end":{"line":13,"column":5}},"7":{"start":{"line":15,"column":4},"end":{"line":15,"column":64}},"8":{"start":{"line":17,"column":20},"end":{"line":17,"column":41}},"9":{"start":{"line":18,"column":4},"end":{"line":18,"column":42}},"10":{"start":{"line":20,"column":0},"end":{"line":20,"column":28}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"default_1","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":18}},"loc":{"start":{"line":9,"column":24},"end":{"line":19,"column":1}},"line":9}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3}},"s":{"0":1,"1":2,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1},"f":{"0":2,"1":1},"b":{"0":[1,1,1],"1":[2,0],"2":[2,2]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/events/events.service.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/events/events.service.ts"],"names":[],"mappings":";;;;;AAGA,iDAAwC;AACxC,6EAAoD;AACpD,kEAAmC;AASnC,mBAAyB,GAAgB;IACvC,MAAM,OAAO,GAAG;QACd,KAAK,EAAE,sBAAW,CAAC,GAAG,CAAC;QACvB,QAAQ,EAAE,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC;KAC9B,CAAC;IAEF,sDAAsD;IACtD,GAAG,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,qBAAM,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAC;IAE7C,4DAA4D;IAC5D,MAAM,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IAEtC,OAAO,CAAC,KAAK,CAAC,sBAAK,CAAC,CAAC;AACvB,CAAC;AAbD,4BAaC","sourcesContent":["// Initializes the `events` service on path `/events`\nimport { ServiceAddons } from '@feathersjs/feathers';\nimport { Application } from '../../declarations';\nimport { Events } from './events.class';\nimport createModel from '../../models/events.model';\nimport hooks from './events.hooks';\n\n// Add this service to the service type index\ndeclare module '../../declarations' {\n  interface ServiceTypes {\n    'events': Events & ServiceAddons<any>;\n  }\n}\n\nexport default function (app: Application): void {\n  const options = {\n    Model: createModel(app),\n    paginate: app.get('paginate')\n  };\n\n  // Initialize our service with any options it requires\n  app.use('/events', new Events(options, app));\n\n  // Get our initialized service so that we can register hooks\n  const service = app.service('events');\n\n  service.hooks(hooks);\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d212b4970f5109c86cd67a42a99d1c403d2fdfae"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/events/events.class.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/events/events.class.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":24}},"4":{"start":{"line":7,"column":29},"end":{"line":7,"column":58}},"5":{"start":{"line":8,"column":14},"end":{"line":8,"column":51}},"6":{"start":{"line":12,"column":8},"end":{"line":12,"column":23}},"7":{"start":{"line":17,"column":8},"end":{"line":19,"column":11}},"8":{"start":{"line":18,"column":12},"end":{"line":18,"column":90}},"9":{"start":{"line":18,"column":60},"end":{"line":18,"column":85}},"10":{"start":{"line":24,"column":27},"end":{"line":24,"column":77}},"11":{"start":{"line":25,"column":8},"end":{"line":36,"column":11}},"12":{"start":{"line":32,"column":12},"end":{"line":34,"column":15}},"13":{"start":{"line":33,"column":16},"end":{"line":33,"column":109}},"14":{"start":{"line":35,"column":12},"end":{"line":35,"column":26}},"15":{"start":{"line":40,"column":27},"end":{"line":40,"column":77}},"16":{"start":{"line":41,"column":8},"end":{"line":46,"column":11}},"17":{"start":{"line":42,"column":12},"end":{"line":44,"column":15}},"18":{"start":{"line":43,"column":16},"end":{"line":43,"column":109}},"19":{"start":{"line":45,"column":12},"end":{"line":45,"column":26}},"20":{"start":{"line":49,"column":0},"end":{"line":49,"column":24}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":4},"end":{"line":11,"column":5}},"loc":{"start":{"line":11,"column":30},"end":{"line":13,"column":5}},"line":11},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":31},"end":{"line":20,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":17,"column":114},"end":{"line":17,"column":115}},"loc":{"start":{"line":17,"column":130},"end":{"line":19,"column":9}},"line":17},"4":{"name":"(anonymous_4)","decl":{"start":{"line":18,"column":46},"end":{"line":18,"column":47}},"loc":{"start":{"line":18,"column":58},"end":{"line":18,"column":87}},"line":18},"5":{"name":"(anonymous_5)","decl":{"start":{"line":22,"column":4},"end":{"line":22,"column":5}},"loc":{"start":{"line":22,"column":40},"end":{"line":37,"column":5}},"line":22},"6":{"name":"(anonymous_6)","decl":{"start":{"line":31,"column":16},"end":{"line":31,"column":17}},"loc":{"start":{"line":31,"column":28},"end":{"line":36,"column":9}},"line":31},"7":{"name":"(anonymous_7)","decl":{"start":{"line":32,"column":27},"end":{"line":32,"column":28}},"loc":{"start":{"line":32,"column":38},"end":{"line":34,"column":13}},"line":32},"8":{"name":"(anonymous_8)","decl":{"start":{"line":39,"column":4},"end":{"line":39,"column":5}},"loc":{"start":{"line":39,"column":38},"end":{"line":47,"column":5}},"line":39},"9":{"name":"(anonymous_9)","decl":{"start":{"line":41,"column":81},"end":{"line":41,"column":82}},"loc":{"start":{"line":41,"column":93},"end":{"line":46,"column":9}},"line":41},"10":{"name":"(anonymous_10)","decl":{"start":{"line":42,"column":27},"end":{"line":42,"column":28}},"loc":{"start":{"line":42,"column":38},"end":{"line":44,"column":13}},"line":42}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":33,"column":16},"end":{"line":33,"column":108}},"type":"cond-expr","locations":[{"start":{"line":33,"column":48},"end":{"line":33,"column":77}},{"start":{"line":33,"column":80},"end":{"line":33,"column":108}}],"line":33},"4":{"loc":{"start":{"line":43,"column":16},"end":{"line":43,"column":108}},"type":"cond-expr","locations":[{"start":{"line":43,"column":48},"end":{"line":43,"column":77}},{"start":{"line":43,"column":80},"end":{"line":43,"column":108}}],"line":43}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":1},"f":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"b":{"0":[1,1,1],"1":[1,0],"2":[1,1],"3":[0,0],"4":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/events/events.class.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/events/events.class.ts"],"names":[],"mappings":";;;;;;AACA,2DAAsE;AACtE,oDAA4B;AAI5B,MAAa,MAAO,SAAQ,4BAAO;IACjC,4DAA4D;IAC5D,YAAY,OAAyC,EAAE,GAAgB;QACrE,KAAK,CAAC,OAAO,CAAC,CAAC;IACjB,CAAC;IAED,qGAAqG;IACrG,KAAK,CAAC,MAAM,CAAC,IAAsB,EAAE,MAAe;QAClD,qIAAqI;QACrI,OAAO,MAAM,aAAG,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,UAAU,CAAE,IAAI,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC,IAAI,CAAE,CAAE,UAAe,EAAE,EAAE;YACrH,OAAO,OAAO,CAAC,GAAG,CAAE,UAAU,CAAC,GAAG,CAAE,CAAC,MAAU,EAAE,EAAE,GAAG,OAAO,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAE,CAAC;QACvF,CAAC,CAAC,CAAC;IACL,CAAC;IAED,wEAAwE;IACxE,KAAK,CAAC,sBAAsB,CAAC,KAAW;QACtC,kIAAkI;QAClI,MAAM,UAAU,GAAG,aAAG,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC;QAC5D,OAAO,MAAM,UAAU,CAAC,OAAO,CAAC;YAC9B,KAAK,EAAE;gBACL,SAAS,EAAE,KAAK,CAAC,QAAQ;gBACzB,UAAU,EAAE,KAAK,CAAC,SAAS;aAC5B;YACD,GAAG,EAAE,IAAI;SACV,CAAC,CAAC,IAAI,CAAE,CAAC,MAAW,EAAE,EAAE;YACvB,MAAM,CAAC,OAAO,CAAE,CAAC,KAAU,EAAE,EAAE;gBAC7B,CAAE,KAAK,CAAC,eAAe,KAAK,CAAC,CAAE,CAAC,CAAC,CAAC,KAAK,CAAC,eAAe,GAAG,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,eAAe,GAAG,IAAI,CAAC;YACjG,CAAC,CAAC,CAAC;YACH,OAAO,MAAM,CAAC;QAChB,CAAC,CAAC,CAAC;IACL,CAAC;IAED,kDAAkD;IAClD,KAAK,CAAC,yBAAyB;QAC7B,MAAM,UAAU,GAAG,aAAG,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC;QAC5D,OAAO,MAAM,UAAU,CAAC,OAAO,CAAE,EAAE,KAAK,EAAE,YAAY,EAAG,GAAG,EAAC,IAAI,EAAC,CAAE,CAAC,IAAI,CAAE,CAAC,MAAW,EAAE,EAAE;YACzF,MAAM,CAAC,OAAO,CAAE,CAAC,KAAU,EAAE,EAAE;gBAC7B,CAAE,KAAK,CAAC,eAAe,KAAK,CAAC,CAAE,CAAC,CAAC,CAAC,KAAK,CAAC,eAAe,GAAG,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,eAAe,GAAG,IAAI,CAAC;YACjG,CAAC,CAAC,CAAC;YACH,OAAO,MAAM,CAAC;QAChB,CAAC,CAAC,CAAC;IACL,CAAC;CAGF;AA5CD,wBA4CC","sourcesContent":["import { Params } from '@feathersjs/feathers';\nimport { Service, SequelizeServiceOptions } from 'feathers-sequelize';\nimport app from '../../app';\nimport { Application } from '../../declarations';\nimport { EventsServiceInterface } from './events.service.interface';\n\nexport class Events extends Service implements EventsServiceInterface {\n  //eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(options: Partial<SequelizeServiceOptions>, app: Application) {\n    super(options);\n  }\n\n  //overriding the create method of the REST service to take into account our Many to Many relationship\n  async create(data: any | Array<any>, params?: Params): Promise<any | any[]> {\n    //inserting list of events into the databse via bulkCreate, a simple create will not returned to the client the created ressources   \n    return await app.get('sequelizeClient').models.events.bulkCreate( data, { validate: true }).then( ( resultList: any) => {\n      return Promise.all( resultList.map( (events:any) => { return events.dataValues; }) );\n    });\n  } \n  \n  // Getting a list of events registered in the same transaction by a user\n  async getEventsByUserAndDate(event : any): Promise<any | any[]> {\n    //inserting list of events into the databse via bulkCreate, a simple create will not returned to the client the created ressources\n    const EventModel = app.get('sequelizeClient').models.events;\n    return await EventModel.findAll({\n      where: { \n        user_uuid: event.userUuid,\n        created_at: event.createdAt\n      }, \n      raw: true\n    }).then( (result: any) => {\n      result.forEach( (event: any) => {\n        ( event.consentDecision === 0 ) ? event.consentDecision = false : event.consentDecision = true;\n      });\n      return result;\n    });\n  } \n\n  // Getting a list of events group by 'created_at' \n  async getEventsGroupByCreatedAt(): Promise<any | any[]> {\n    const EventModel = app.get('sequelizeClient').models.events;\n    return await EventModel.findAll( { group: 'created_at' , raw:true} ).then( (result: any) => {\n      result.forEach( (event: any) => {\n        ( event.consentDecision === 0 ) ? event.consentDecision = false : event.consentDecision = true;\n      });\n      return result;\n    });\n  } \n    \n\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"fb6c7e718ecdc7578dedb008414b891e9387ed94"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/models/events.model.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/models/events.model.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":5,"column":20},"end":{"line":5,"column":40}},"2":{"start":{"line":10,"column":28},"end":{"line":10,"column":54}},"3":{"start":{"line":11,"column":19},"end":{"line":79,"column":6}},"4":{"start":{"line":69,"column":16},"end":{"line":69,"column":35}},"5":{"start":{"line":81,"column":4},"end":{"line":86,"column":6}},"6":{"start":{"line":83,"column":8},"end":{"line":85,"column":11}},"7":{"start":{"line":87,"column":4},"end":{"line":87,"column":18}},"8":{"start":{"line":89,"column":0},"end":{"line":89,"column":28}}},"fnMap":{"0":{"name":"default_1","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":18}},"loc":{"start":{"line":9,"column":24},"end":{"line":88,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":68,"column":12},"end":{"line":68,"column":13}},"loc":{"start":{"line":68,"column":33},"end":{"line":70,"column":13}},"line":68},"2":{"name":"(anonymous_2)","decl":{"start":{"line":81,"column":23},"end":{"line":81,"column":24}},"loc":{"start":{"line":81,"column":41},"end":{"line":86,"column":5}},"line":81}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":0,"5":1,"6":1,"7":1,"8":1},"f":{"0":1,"1":0,"2":1},"b":{},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/models/events.model.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/models/events.model.ts"],"names":[],"mappings":";;AAAA,oEAAoE;AACpE,oCAAoC;AACpC,yCAAwD;AAIxD,sGAAsG;AACtG,4EAA4E;AAC5E,6IAA6I;AAC7I,mBAAyB,GAAgB;IACvC,MAAM,eAAe,GAAc,GAAG,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;IAC9D,MAAM,MAAM,GAAG,eAAe,CAAC,MAAM,CAAC,QAAQ,EAAE;QAC9C,kBAAkB;QAClB,EAAE,EAAE;YACF,IAAI,EAAE,qBAAS,CAAC,OAAO;YACvB,UAAU,EAAE,IAAI;YAChB,aAAa,EAAE,IAAI;YACnB,SAAS,EAAE,KAAK;SACjB;QACD,oGAAoG;QACpG,QAAQ,EAAE;YACR,IAAI,EAAE,qBAAS,CAAC,IAAI;YACpB,MAAM,EAAE,wBAAwB;YAChC,SAAS,EAAE,KAAK;SACjB;QACD,oIAAoI;QACpI,iIAAiI;QACjI,mEAAmE;QACnE,YAAY,EAAE;YACZ,IAAI,EAAE,qBAAS,CAAC,MAAM;YACtB,SAAS,EAAE,KAAK;YAChB,8EAA8E;YAC9E,MAAM,EAAE,wBAAwB;YAChC,QAAQ,EAAE;gBACR,IAAI,EAAE;oBACJ,IAAI,EAAE,CAAC,CAAC,qBAAqB,EAAE,mBAAmB,CAAC,CAAC;oBACpD,GAAG,EAAE,0DAA0D;iBAChE;gBACD,OAAO,EAAE;oBACP,GAAG,EAAE,2BAA2B;iBACjC;aACF;SACF;QACD,+FAA+F;QAC/F,eAAe,EAAE;YACf,IAAI,EAAE,qBAAS,CAAC,OAAO;YACvB,SAAS,EAAE,KAAK;YAChB,MAAM,EAAE,wBAAwB;YAChC,QAAQ,EAAE;gBACR,OAAO,EAAE;oBACP,GAAG,EAAE,+CAA+C;iBACrD;aACF;SACF;QACD,SAAS,EAAE;YACT,IAAI,EAAE,qBAAS,CAAC,IAAI;YACpB,SAAS,EAAE,KAAK;YAChB,MAAM,EAAE,wBAAwB;YAChC,QAAQ,EAAE;gBACR,OAAO,EAAE;oBACP,GAAG,EAAE,oCAAoC;iBAC1C;aACF;SACF;KACF,EAAE;QACD,iGAAiG;QACjG,UAAU,EAAE,KAAK;QACjB,KAAK,EAAE;YACL,WAAW,CAAC,OAAY;gBACtB,OAAO,CAAC,GAAG,GAAG,IAAI,CAAC;YACrB,CAAC;YACD;;;;;;cAME;SACH;KACF,CAAC,CAAC;IAEH,6DAA6D;IAC5D,MAAc,CAAC,SAAS,GAAG,UAAU,MAAW;QAC/C,yBAAyB;QACzB,MAAM,CAAC,SAAS,CAAC,eAAe,CAAC,MAAM,CAAC,KAAK,EAAE;YAC7C,SAAS,EAAE,MAAM;SAClB,CAAC,CAAC;IAEL,CAAC,CAAC;IAEF,OAAO,MAAM,CAAC;AAChB,CAAC;AAlFD,4BAkFC","sourcesContent":["// See http://docs.sequelizejs.com/en/latest/docs/models-definition/\n// for more of what you can do here.\nimport { Sequelize, DataTypes, Model } from 'sequelize';\nimport { Application } from '../declarations';\nimport { HookReturn } from 'sequelize/types/lib/hooks';\n\n// A personnalized Model for the assiociation table inside of automatically generating it by Sequelize\n// resulting from the Many to Many relation between Users and Consent tables\n// I manually define foreign keys and define a 'unique' constraint on 3 fields to ensure unicity of every user's event stored in this table. \nexport default function (app: Application): typeof Model {\n  const sequelizeClient: Sequelize = app.get('sequelizeClient');\n  const events = sequelizeClient.define('events', {\n    //The event row id\n    id: {\n      type: DataTypes.INTEGER,\n      primaryKey: true,\n      autoIncrement: true,\n      allowNull: false\n    },    \n    // I manually create the 'Foreign Key' (look at associations), since I would like to personalize it \n    userUuid: {\n      type: DataTypes.UUID,\n      unique: 'eventUnicityConstraint',\n      allowNull: false\n    },\n    // A personalized name for the 'unique' constraint so that a notification 'Event' should always be unique in this association table \n    // This labelled unicity constraint will be for theses 4 fields : uuid, consent decision, consent id and event creation date     \n    //Example of consent label : sms_notifications, email_notifications\n    consentLabel: {\n      type: DataTypes.STRING,\n      allowNull: false,\n      // A constraint unicity on these couple of filed in the table : id and enabled\n      unique: 'eventUnicityConstraint',\n      validate: {\n        isIn: {\n          args: [['email_notifications', 'sms_notifications']],\n          msg: 'Must be \\'email_notifications\\' or \\'sms_notifications\\''\n        },\n        notNull: {\n          msg: 'A consent id is mandatory'\n        }\n      }\n    },\n    //Decision on a consent, e.g : bolean \"true or false\" (on postrgres), tinyint \"0 or 1\" on mysql\n    consentDecision: {\n      type: DataTypes.BOOLEAN,\n      allowNull: false,\n      unique: 'eventUnicityConstraint',\n      validate: {\n        notNull: {\n          msg: 'A decision must be taken reltive to a consent'\n        }\n      }\n    },\n    createdAt: {\n      type: DataTypes.DATE,\n      allowNull: false,\n      unique: 'eventUnicityConstraint',\n      validate: {\n        notNull: {\n          msg: 'The date of the event is mandatory'\n        }\n      }\n    }    \n  }, {\n    //Sequelize will not automatically generate the fields 'createdAt' and 'updatedAt' for this table\n    timestamps: false, \n    hooks: {\n      beforeCount(options: any): HookReturn {\n        options.raw = true;\n      }\n      /*,\n      afterBulkCreate: function ( options: any, queryOptions: any ): HookReturn {\n        queryOptions = typeof queryOptions === 'object' && queryOptions || {};\n        queryOptions.raw = true;\n        return this.findAll( options, queryOptions );\n      }\n      */\n    }\n  });\n  \n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  (events as any).associate = function (models: any): void {\n    // Defining associations \n    events.belongsTo(sequelizeClient.models.users, {\n      targetKey: 'uuid'\n    });\n\n  };\n \n  return events;\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"85aa02c36d794b30b81b826c1dd3fc4caffcd8ae"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/events/events.hooks.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/events/events.hooks.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":8,"column":3}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"2":{"start":{"line":3,"column":26},"end":{"line":3,"column":33}},"3":{"start":{"line":4,"column":4},"end":{"line":4,"column":89}},"4":{"start":{"line":4,"column":71},"end":{"line":4,"column":83}},"5":{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},"6":{"start":{"line":6,"column":26},"end":{"line":6,"column":33}},"7":{"start":{"line":7,"column":4},"end":{"line":7,"column":17}},"8":{"start":{"line":9,"column":25},"end":{"line":13,"column":2}},"9":{"start":{"line":10,"column":4},"end":{"line":10,"column":72}},"10":{"start":{"line":12,"column":4},"end":{"line":12,"column":21}},"11":{"start":{"line":14,"column":19},"end":{"line":20,"column":1}},"12":{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},"13":{"start":{"line":15,"column":31},"end":{"line":15,"column":42}},"14":{"start":{"line":16,"column":17},"end":{"line":16,"column":19}},"15":{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},"16":{"start":{"line":17,"column":21},"end":{"line":17,"column":141}},"17":{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},"18":{"start":{"line":17,"column":109},"end":{"line":17,"column":141}},"19":{"start":{"line":18,"column":4},"end":{"line":18,"column":36}},"20":{"start":{"line":19,"column":4},"end":{"line":19,"column":18}},"21":{"start":{"line":21,"column":0},"end":{"line":21,"column":62}},"22":{"start":{"line":22,"column":23},"end":{"line":22,"column":74}},"23":{"start":{"line":23,"column":40},"end":{"line":23,"column":100}},"24":{"start":{"line":24,"column":21},"end":{"line":24,"column":62}},"25":{"start":{"line":26,"column":25},"end":{"line":26,"column":45}},"26":{"start":{"line":31,"column":34},"end":{"line":40,"column":1}},"27":{"start":{"line":32,"column":4},"end":{"line":39,"column":6}},"28":{"start":{"line":33,"column":27},"end":{"line":33,"column":34}},"29":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"30":{"start":{"line":35,"column":12},"end":{"line":35,"column":136}},"31":{"start":{"line":38,"column":8},"end":{"line":38,"column":23}},"32":{"start":{"line":46,"column":32},"end":{"line":79,"column":1}},"33":{"start":{"line":47,"column":4},"end":{"line":78,"column":6}},"34":{"start":{"line":48,"column":25},"end":{"line":48,"column":32}},"35":{"start":{"line":50,"column":37},"end":{"line":61,"column":9}},"36":{"start":{"line":52,"column":35},"end":{"line":52,"column":55}},"37":{"start":{"line":55,"column":12},"end":{"line":60,"column":14}},"38":{"start":{"line":63,"column":35},"end":{"line":63,"column":37}},"39":{"start":{"line":64,"column":8},"end":{"line":75,"column":9}},"40":{"start":{"line":65,"column":12},"end":{"line":70,"column":13}},"41":{"start":{"line":66,"column":16},"end":{"line":66,"column":98}},"42":{"start":{"line":69,"column":16},"end":{"line":69,"column":101}},"43":{"start":{"line":71,"column":12},"end":{"line":71,"column":48}},"44":{"start":{"line":74,"column":12},"end":{"line":74,"column":89}},"45":{"start":{"line":77,"column":8},"end":{"line":77,"column":23}},"46":{"start":{"line":83,"column":29},"end":{"line":132,"column":1}},"47":{"start":{"line":84,"column":4},"end":{"line":131,"column":6}},"48":{"start":{"line":85,"column":40},"end":{"line":85,"column":47}},"49":{"start":{"line":87,"column":42},"end":{"line":100,"column":9}},"50":{"start":{"line":89,"column":35},"end":{"line":89,"column":37}},"51":{"start":{"line":91,"column":32},"end":{"line":91,"column":89}},"52":{"start":{"line":93,"column":12},"end":{"line":98,"column":15}},"53":{"start":{"line":94,"column":16},"end":{"line":97,"column":19}},"54":{"start":{"line":99,"column":12},"end":{"line":99,"column":34}},"55":{"start":{"line":102,"column":39},"end":{"line":109,"column":9}},"56":{"start":{"line":103,"column":12},"end":{"line":108,"column":14}},"57":{"start":{"line":110,"column":8},"end":{"line":128,"column":9}},"58":{"start":{"line":111,"column":12},"end":{"line":121,"column":13}},"59":{"start":{"line":112,"column":16},"end":{"line":120,"column":17}},"60":{"start":{"line":115,"column":20},"end":{"line":115,"column":90}},"61":{"start":{"line":116,"column":20},"end":{"line":119,"column":24}},"62":{"start":{"line":117,"column":47},"end":{"line":117,"column":99}},"63":{"start":{"line":118,"column":24},"end":{"line":118,"column":100}},"64":{"start":{"line":126,"column":35},"end":{"line":126,"column":77}},"65":{"start":{"line":127,"column":12},"end":{"line":127,"column":88}},"66":{"start":{"line":130,"column":8},"end":{"line":130,"column":23}},"67":{"start":{"line":133,"column":0},"end":{"line":164,"column":2}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":74},"end":{"line":2,"column":75}},"loc":{"start":{"line":2,"column":96},"end":{"line":5,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":4,"column":58},"end":{"line":4,"column":59}},"loc":{"start":{"line":4,"column":69},"end":{"line":4,"column":85}},"line":4},"2":{"name":"(anonymous_2)","decl":{"start":{"line":5,"column":6},"end":{"line":5,"column":7}},"loc":{"start":{"line":5,"column":28},"end":{"line":8,"column":1}},"line":5},"3":{"name":"(anonymous_3)","decl":{"start":{"line":9,"column":80},"end":{"line":9,"column":81}},"loc":{"start":{"line":9,"column":95},"end":{"line":11,"column":1}},"line":9},"4":{"name":"(anonymous_4)","decl":{"start":{"line":11,"column":5},"end":{"line":11,"column":6}},"loc":{"start":{"line":11,"column":20},"end":{"line":13,"column":1}},"line":11},"5":{"name":"(anonymous_5)","decl":{"start":{"line":14,"column":50},"end":{"line":14,"column":51}},"loc":{"start":{"line":14,"column":65},"end":{"line":20,"column":1}},"line":14},"6":{"name":"(anonymous_6)","decl":{"start":{"line":31,"column":34},"end":{"line":31,"column":35}},"loc":{"start":{"line":31,"column":40},"end":{"line":40,"column":1}},"line":31},"7":{"name":"(anonymous_7)","decl":{"start":{"line":32,"column":11},"end":{"line":32,"column":12}},"loc":{"start":{"line":32,"column":30},"end":{"line":39,"column":5}},"line":32},"8":{"name":"(anonymous_8)","decl":{"start":{"line":46,"column":32},"end":{"line":46,"column":33}},"loc":{"start":{"line":46,"column":38},"end":{"line":79,"column":1}},"line":46},"9":{"name":"(anonymous_9)","decl":{"start":{"line":47,"column":11},"end":{"line":47,"column":12}},"loc":{"start":{"line":47,"column":30},"end":{"line":78,"column":5}},"line":47},"10":{"name":"(anonymous_10)","decl":{"start":{"line":50,"column":37},"end":{"line":50,"column":38}},"loc":{"start":{"line":50,"column":56},"end":{"line":61,"column":9}},"line":50},"11":{"name":"(anonymous_11)","decl":{"start":{"line":83,"column":29},"end":{"line":83,"column":30}},"loc":{"start":{"line":83,"column":35},"end":{"line":132,"column":1}},"line":83},"12":{"name":"(anonymous_12)","decl":{"start":{"line":84,"column":11},"end":{"line":84,"column":12}},"loc":{"start":{"line":84,"column":30},"end":{"line":131,"column":5}},"line":84},"13":{"name":"(anonymous_13)","decl":{"start":{"line":87,"column":42},"end":{"line":87,"column":43}},"loc":{"start":{"line":87,"column":59},"end":{"line":100,"column":9}},"line":87},"14":{"name":"(anonymous_14)","decl":{"start":{"line":93,"column":32},"end":{"line":93,"column":33}},"loc":{"start":{"line":93,"column":50},"end":{"line":98,"column":13}},"line":93},"15":{"name":"(anonymous_15)","decl":{"start":{"line":102,"column":39},"end":{"line":102,"column":40}},"loc":{"start":{"line":102,"column":59},"end":{"line":109,"column":9}},"line":102},"16":{"name":"(anonymous_16)","decl":{"start":{"line":116,"column":71},"end":{"line":116,"column":72}},"loc":{"start":{"line":116,"column":102},"end":{"line":119,"column":21}},"line":116}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":8,"column":3}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":57},"end":{"line":8,"column":2}}],"line":2},"1":{"loc":{"start":{"line":2,"column":57},"end":{"line":8,"column":2}},"type":"cond-expr","locations":[{"start":{"line":2,"column":74},"end":{"line":5,"column":1}},{"start":{"line":5,"column":6},"end":{"line":8,"column":1}}],"line":2},"2":{"loc":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"type":"if","locations":[{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},{"start":{"line":3,"column":4},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},"type":"if","locations":[{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},{"start":{"line":6,"column":4},"end":{"line":6,"column":33}}],"line":6},"4":{"loc":{"start":{"line":9,"column":25},"end":{"line":13,"column":2}},"type":"binary-expr","locations":[{"start":{"line":9,"column":26},"end":{"line":9,"column":30}},{"start":{"line":9,"column":34},"end":{"line":9,"column":57}},{"start":{"line":9,"column":63},"end":{"line":13,"column":1}}],"line":9},"5":{"loc":{"start":{"line":9,"column":63},"end":{"line":13,"column":1}},"type":"cond-expr","locations":[{"start":{"line":9,"column":80},"end":{"line":11,"column":1}},{"start":{"line":11,"column":5},"end":{"line":13,"column":1}}],"line":9},"6":{"loc":{"start":{"line":14,"column":19},"end":{"line":20,"column":1}},"type":"binary-expr","locations":[{"start":{"line":14,"column":20},"end":{"line":14,"column":24}},{"start":{"line":14,"column":28},"end":{"line":14,"column":45}},{"start":{"line":14,"column":50},"end":{"line":20,"column":1}}],"line":14},"7":{"loc":{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},"type":"if","locations":[{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},{"start":{"line":15,"column":4},"end":{"line":15,"column":42}}],"line":15},"8":{"loc":{"start":{"line":15,"column":8},"end":{"line":15,"column":29}},"type":"binary-expr","locations":[{"start":{"line":15,"column":8},"end":{"line":15,"column":11}},{"start":{"line":15,"column":15},"end":{"line":15,"column":29}}],"line":15},"9":{"loc":{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},"type":"if","locations":[{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},{"start":{"line":17,"column":4},"end":{"line":17,"column":141}}],"line":17},"10":{"loc":{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},"type":"if","locations":[{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},{"start":{"line":17,"column":40},"end":{"line":17,"column":141}}],"line":17},"11":{"loc":{"start":{"line":17,"column":44},"end":{"line":17,"column":107}},"type":"binary-expr","locations":[{"start":{"line":17,"column":44},"end":{"line":17,"column":59}},{"start":{"line":17,"column":63},"end":{"line":17,"column":107}}],"line":17},"12":{"loc":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"type":"if","locations":[{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},{"start":{"line":34,"column":8},"end":{"line":36,"column":9}}],"line":34},"13":{"loc":{"start":{"line":34,"column":12},"end":{"line":34,"column":76}},"type":"binary-expr","locations":[{"start":{"line":34,"column":12},"end":{"line":34,"column":31}},{"start":{"line":34,"column":35},"end":{"line":34,"column":53}},{"start":{"line":34,"column":57},"end":{"line":34,"column":76}}],"line":34},"14":{"loc":{"start":{"line":64,"column":8},"end":{"line":75,"column":9}},"type":"if","locations":[{"start":{"line":64,"column":8},"end":{"line":75,"column":9}},{"start":{"line":64,"column":8},"end":{"line":75,"column":9}}],"line":64},"15":{"loc":{"start":{"line":65,"column":12},"end":{"line":70,"column":13}},"type":"if","locations":[{"start":{"line":65,"column":12},"end":{"line":70,"column":13}},{"start":{"line":65,"column":12},"end":{"line":70,"column":13}}],"line":65},"16":{"loc":{"start":{"line":110,"column":8},"end":{"line":128,"column":9}},"type":"if","locations":[{"start":{"line":110,"column":8},"end":{"line":128,"column":9}},{"start":{"line":110,"column":8},"end":{"line":128,"column":9}}],"line":110},"17":{"loc":{"start":{"line":111,"column":12},"end":{"line":121,"column":13}},"type":"if","locations":[{"start":{"line":111,"column":12},"end":{"line":121,"column":13}},{"start":{"line":111,"column":12},"end":{"line":121,"column":13}}],"line":111},"18":{"loc":{"start":{"line":112,"column":16},"end":{"line":120,"column":17}},"type":"if","locations":[{"start":{"line":112,"column":16},"end":{"line":120,"column":17}},{"start":{"line":112,"column":16},"end":{"line":120,"column":17}}],"line":112}},"s":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":1,"9":0,"10":0,"11":1,"12":1,"13":1,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":0,"29":0,"30":0,"31":0,"32":1,"33":1,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":1,"47":1,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":1},"f":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":1,"6":1,"7":0,"8":1,"9":0,"10":0,"11":1,"12":0,"13":0,"14":0,"15":0,"16":0},"b":{"0":[1,1,1],"1":[1,0],"2":[0,0],"3":[0,0],"4":[1,1,1],"5":[1,0],"6":[1,1,1],"7":[1,0],"8":[1,1],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/events/events.hooks.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/services/events/events.hooks.ts"],"names":[],"mappings":"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","sourcesContent":["import * as authentication from '@feathersjs/authentication';\nimport { HookContext } from '@feathersjs/feathers';\nimport { EventServiceForbidden } from '../../errors/events/event.service.forbidden.error';\nimport { ZeroEvent } from '../../errors/events/zero.event';\n// Don't remove this comment. It's needed to format import lines nicely.\n\nconst { authenticate } = authentication.hooks;\n\n\n/*\n  Controling the Event service access \n  According to the exercice we should not be able to update or delete envents\n*/\nconst controlEnventServiceAcces = () => {\n\n  return async (context: HookContext) => {\n    const { method } = context;\n    if (method === 'update' || method === 'patch'  || method === 'remove'){ \n      throw new EventServiceForbidden('This service is forbidden on this events service', method);\n    }\n    //returning the context as best practice\n    return context;\n  };\n}; \n\n/*\n  Will be call before every create request on the Event service\n  Formating the event's data accordingly to the event table strucure,  \n  and integrating them in the Hook context for further processing\n*/ \nconst buildEventsDataToPersit = () => {\n  \n  return async (context: HookContext) => {\n\n    const { data } = context;\n\n    // Function to iterate on every consent object in the user's array of consent\n    const formatEventToPersist = async (consent : any) => {\n      // prepare the creation date of the event as recommended by the exercice\n      const eventCreatedAt = new Date().getTime();\n      // Building an event instance as it will be inserted accordingly to the \"event\" table structure. An event Id will be auto-generated by the database. \n      // A 'unique' constraint has been configure on the Sequelise schema of the table for the columns (created_at, userUuid, consent_label, consent_decision)\n      return { \n        'createdAt': eventCreatedAt, \n        'userUuid': data.user.id, \n        'consentLabel': consent.id,\n        'consentDecision': consent.enabled\n      };\n    };\n    //The object listOfEventToPersist is to collect the list of event to persist in database for the current User\n    let listOfEventToPersist : Array<any> = [];\n    if(data.consents){\n      if(data.consents.length > 0){\n        listOfEventToPersist = await Promise.all( data.consents.map(formatEventToPersist) );\n      }\n      else{\n        throw new ZeroEvent('At least one event is needed from the User', data);\n      }\n      context.data = listOfEventToPersist; \n    } \n    else{\n      throw new ZeroEvent('No event has been sent by the User', data);\n    }\n    //returning the context as best practice\n    return context;\n  };\n}; \n \n/*\n    Will be call \"after\" every CRUD request on the Event service, before returning the event data to the API's client\n  */\nconst formatEventToDisplay = () => {\n\n  return async (context: HookContext) => {\n\n    const { result, method, app } = context;\n\n    // Is use this fonction to transform an event from the event table structure to API client event structure\n    const getFormattedListOfConsent = async ( event : any) => {\n      //Will contain the list of consents relative to this event for the user, \n      const listOfConsents: Array<any> = [];\n      // Get the list of consents registered at the same time as one event\n      const listOfEvent = await app.service('events').getEventsByUserAndDate(event);\n      // Format the list of event as the API client wants\n      listOfEvent.forEach( (currentEvent: any) => {\n        listOfConsents.push({\n          'id': currentEvent.consentLabel,\n          'enabled': currentEvent.consentDecision\n        });\n      });  \n      return listOfConsents;  \n    };\n    // Is use this fonction to return the final template of an event, accordingly to the API client event structure\n    const getFinalFormattedEvent =  ( Uuid: any, evenList: any[]) => {\n      return context.result = {\n        'user': {\n          'id': Uuid\n        },\n        'consents': evenList\n      };  \n    };\n\n    if(method === 'find') {\n      if(result.data){\n        if(result.data.length > 0){\n          // Map all events from database to build the list of Event in the API client format \n          // Limit the list of events to iterate : a list of event grouped by 'created_at' column\n          result.data = await app.service('events').getEventsGroupByCreatedAt();\n          context.result = await Promise.all(result.data.map( async (currentGroupedEvent: any) =>{\n            const listOfConsents = await getFormattedListOfConsent(currentGroupedEvent);\n            return getFinalFormattedEvent(currentGroupedEvent.userUuid, listOfConsents);\n          }));\n        }\n      }\n    }\n    else {\n      // Otherwise just deal wit the single event result accordingly to its consents, \n      // using only one of the consent in the event is sufficient to format the events to display\n      const listOfConsents = await getFormattedListOfConsent(result[0]); \n      context.result = getFinalFormattedEvent(result[0].userUuid, listOfConsents);\n    } \n  \n    // We return the hook context\n    return context;\n  };\n};\n\n\nexport default {\n  before: {\n    //All securized all web service with Jwt token\n    //control the REST method before each incoming request, the exercice require not be let possible event update and delete\n    all: [ authenticate('jwt'), controlEnventServiceAcces() ],\n    find: [],\n    get: [],\n    //prepare our events data before storage into event table\n    create: [ buildEventsDataToPersit() ],\n    update: [],\n    patch: [],\n    remove: []\n  },\n\n  after: {\n    all: [ formatEventToDisplay() ],\n    find: [],\n    get: [],\n    create: [],\n    update: [],\n    patch: [],\n    remove: []\n  },\n\n  error: {\n    all: [],\n    find: [],\n    get: [],\n    create: [],\n    update: [],\n    patch: [],\n    remove: []\n  }\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"de06953a85e69fe7763cffee828c85f00b621c0a"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/events/event.service.forbidden.error.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/events/event.service.forbidden.error.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":39}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":46}},"3":{"start":{"line":8,"column":8},"end":{"line":8,"column":96}},"4":{"start":{"line":11,"column":0},"end":{"line":11,"column":54}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":6,"column":4},"end":{"line":6,"column":5}},"loc":{"start":{"line":6,"column":31},"end":{"line":9,"column":5}},"line":6}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":0,"4":1},"f":{"0":0},"b":{},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/events/event.service.forbidden.error.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/events/event.service.forbidden.error.ts"],"names":[],"mappings":";;;AAAA,+CAAmD;AAEnD,MAAa,qBAAsB,SAAQ,sBAAa;IACtD,YAAY,OAAe,EAAE,IAAS;QACpC,yCAAyC;QACzC,KAAK,CAAC,OAAO,EAAE,mCAAmC,EAAE,GAAG,EAAE,uBAAuB,EAAE,IAAI,CAAC,CAAC;IAC1F,CAAC;CACF;AALD,sDAKC","sourcesContent":["import { FeathersError } from '@feathersjs/errors';\n\nexport class EventServiceForbidden extends FeathersError {\n  constructor(message: string, data: any) {\n    // I send a 405 code (Method not allowed)\n    super(message, 'Event service forbidden Exception', 405, 'EventServiceForbidden', data);\n  }\n}\n\n\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c2be216538f8bc920820ffa1c3e175fad00a44ce"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/events/zero.event.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/events/zero.event.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":46}},"3":{"start":{"line":8,"column":8},"end":{"line":8,"column":71}},"4":{"start":{"line":11,"column":0},"end":{"line":11,"column":30}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":6,"column":4},"end":{"line":6,"column":5}},"loc":{"start":{"line":6,"column":31},"end":{"line":9,"column":5}},"line":6}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":0,"4":1},"f":{"0":0},"b":{},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/events/zero.event.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/errors/events/zero.event.ts"],"names":[],"mappings":";;;AAAA,+CAAmD;AAEnD,MAAa,SAAU,SAAQ,sBAAa;IAC1C,YAAY,OAAe,EAAE,IAAS;QACpC,qCAAqC;QACrC,KAAK,CAAC,OAAO,EAAE,sBAAsB,EAAE,GAAG,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC;IACjE,CAAC;CACF;AALD,8BAKC","sourcesContent":["import { FeathersError } from '@feathersjs/errors';\n\nexport class ZeroEvent extends FeathersError {\n  constructor(message: string, data: any) {\n    // I send a 406 code (Not acceptable)\n    super(message, 'Zero event Exception', 406, 'ZeroEvent', data);\n  }\n}\n\n\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5c07c8041dccfaae6bf3f7094549658e1d828287"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/app.hooks.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/app.hooks.ts","statementMap":{"0":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"1":{"start":{"line":23,"column":0},"end":{"line":51,"column":2}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1},"f":{},"b":{},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/app.hooks.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/app.hooks.ts"],"names":[],"mappings":";AAAA,+CAA+C;AAC/C,wEAAwE;AACxE,0CAA0C;;AAE1C;;;;;;;;;;;;;;;;EAgBE;AAGF,kBAAe;IACb,MAAM,EAAE;QACN,GAAG,EAAE,EAAE;QACP,IAAI,EAAE,EAAE;QACR,GAAG,EAAE,EAAE;QACP,MAAM,EAAE,EAAE;QACV,MAAM,EAAE,EAAE;QACV,KAAK,EAAE,EAAE;QACT,MAAM,EAAE,EAAE;KACX;IAED,KAAK,EAAE;QACL,GAAG,EAAE,EAAE;QACP,IAAI,EAAE,EAAE;QACR,GAAG,EAAE,EAAE;QACP,MAAM,EAAE,EAAE;QACV,MAAM,EAAE,EAAE;QACV,KAAK,EAAE,EAAE;QACT,MAAM,EAAE,EAAE;KACX;IAED,KAAK,EAAE;QACL,GAAG,EAAE,EAAI;QACT,IAAI,EAAE,EAAE;QACR,GAAG,EAAE,EAAE;QACP,MAAM,EAAE,EAAE;QACV,MAAM,EAAE,EAAE;QACV,KAAK,EAAE,EAAE;QACT,MAAM,EAAE,EAAE;KACX;CACF,CAAC","sourcesContent":["// Application hooks that run for every service\n// Don't remove this comment. It's needed to format import lines nicely.\n//import errors from '@feathersjs/errors';\n\n/*\n// Error Handler to run on every service in the Apps\nconst errorHandler = (ctx: any) => {\n  if (ctx.error) {\n    const error = ctx.error;\n    if (!error.code) {\n      const newError = new errors.GeneralError('Didomi\\'s server error');\n      ctx.error = newError;\n      return ctx;\n    }\n    if (error.code === 404 || process.env.NODE_ENV === 'production') {\n      error.stack = null;\n    }\n    return ctx;\n  }\n};\n*/\n\n\nexport default {\n  before: {\n    all: [],\n    find: [],\n    get: [],\n    create: [],\n    update: [],\n    patch: [],\n    remove: []\n  },\n\n  after: {\n    all: [],\n    find: [],\n    get: [],\n    create: [],\n    update: [],\n    patch: [],\n    remove: []\n  },\n\n  error: {\n    all: [  ],\n    find: [],\n    get: [],\n    create: [],\n    update: [],\n    patch: [],\n    remove: []\n  }\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e6d9d93d2267b9dc5f1fbd5b95230ae6799e50d8"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/channels.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/channels.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":41}},"2":{"start":{"line":5,"column":4},"end":{"line":8,"column":5}},"3":{"start":{"line":7,"column":8},"end":{"line":7,"column":15}},"4":{"start":{"line":9,"column":4},"end":{"line":12,"column":7}},"5":{"start":{"line":11,"column":8},"end":{"line":11,"column":50}},"6":{"start":{"line":13,"column":4},"end":{"line":32,"column":7}},"7":{"start":{"line":16,"column":8},"end":{"line":31,"column":9}},"8":{"start":{"line":20,"column":12},"end":{"line":20,"column":55}},"9":{"start":{"line":22,"column":12},"end":{"line":22,"column":58}},"10":{"start":{"line":34,"column":4},"end":{"line":40,"column":7}},"11":{"start":{"line":37,"column":8},"end":{"line":37,"column":163}},"12":{"start":{"line":39,"column":8},"end":{"line":39,"column":44}},"13":{"start":{"line":52,"column":0},"end":{"line":52,"column":28}}},"fnMap":{"0":{"name":"default_1","decl":{"start":{"line":4,"column":9},"end":{"line":4,"column":18}},"loc":{"start":{"line":4,"column":24},"end":{"line":51,"column":1}},"line":4},"1":{"name":"(anonymous_1)","decl":{"start":{"line":9,"column":25},"end":{"line":9,"column":26}},"loc":{"start":{"line":9,"column":41},"end":{"line":12,"column":5}},"line":9},"2":{"name":"(anonymous_2)","decl":{"start":{"line":13,"column":20},"end":{"line":13,"column":21}},"loc":{"start":{"line":13,"column":52},"end":{"line":32,"column":5}},"line":13},"3":{"name":"(anonymous_3)","decl":{"start":{"line":34,"column":16},"end":{"line":34,"column":17}},"loc":{"start":{"line":34,"column":32},"end":{"line":40,"column":5}},"line":34}},"branchMap":{"0":{"loc":{"start":{"line":5,"column":4},"end":{"line":8,"column":5}},"type":"if","locations":[{"start":{"line":5,"column":4},"end":{"line":8,"column":5}},{"start":{"line":5,"column":4},"end":{"line":8,"column":5}}],"line":5},"1":{"loc":{"start":{"line":16,"column":8},"end":{"line":31,"column":9}},"type":"if","locations":[{"start":{"line":16,"column":8},"end":{"line":31,"column":9}},{"start":{"line":16,"column":8},"end":{"line":31,"column":9}}],"line":16}},"s":{"0":1,"1":1,"2":1,"3":0,"4":1,"5":0,"6":1,"7":0,"8":0,"9":0,"10":1,"11":0,"12":0,"13":1},"f":{"0":1,"1":0,"2":0,"3":0},"b":{"0":[0,1],"1":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/channels.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/channels.ts"],"names":[],"mappings":";;AAAA,yCAAuC;AAIvC,mBAAwB,GAAgB;IACtC,IAAG,OAAO,GAAG,CAAC,OAAO,KAAK,UAAU,EAAE;QACpC,gEAAgE;QAChE,OAAO;KACR;IAED,GAAG,CAAC,EAAE,CAAC,YAAY,EAAE,CAAC,UAAe,EAAQ,EAAE;QAC7C,iEAAiE;QACjE,GAAG,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IAC5C,CAAC,CAAC,CAAC;IAEH,GAAG,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,UAAe,EAAE,EAAE,UAAU,EAAO,EAAQ,EAAE;QAC7D,6CAA6C;QAC7C,sDAAsD;QACtD,IAAG,UAAU,EAAE;YACb,gDAAgD;YAChD,gCAAgC;YAEhC,mDAAmD;YACnD,GAAG,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;YAE3C,2CAA2C;YAC3C,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAE9C,8DAA8D;YAE9D,mDAAmD;YACnD,+DAA+D;YAE/D,yCAAyC;YACzC,8GAA8G;YAE9G,sEAAsE;YACtE,wDAAwD;YACxD,sDAAsD;SACvD;IACH,CAAC,CAAC,CAAC;IAEH,6DAA6D;IAC7D,GAAG,CAAC,OAAO,CAAC,CAAC,IAAS,EAAE,IAAiB,EAAE,EAAE;QAC3C,wEAAwE;QACxE,8EAA8E;QAE9E,OAAO,CAAC,GAAG,CAAC,6IAA6I,CAAC,CAAC,CAAC,sBAAsB;QAElL,oEAAoE;QACpE,OAAO,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;IACtC,CAAC,CAAC,CAAC;IAEH,0DAA0D;IAC1D,+EAA+E;IAC/E,wEAAwE;IAExE,yFAAyF;IACzF,0CAA0C;IAC1C,aAAa;IACb,gDAAgD;IAChD,mDAAmD;IACnD,OAAO;IACP,MAAM;AACR,CAAC;AA5DD,4BA4DC","sourcesContent":["import '@feathersjs/transport-commons';\nimport { HookContext } from '@feathersjs/feathers';\nimport { Application } from './declarations';\n\nexport default function(app: Application): void {\n  if(typeof app.channel !== 'function') {\n    // If no real-time functionality has been configured just return\n    return;\n  }\n\n  app.on('connection', (connection: any): void => {\n    // On a new real-time connection, add it to the anonymous channel\n    app.channel('anonymous').join(connection);\n  });\n\n  app.on('login', (authResult: any, { connection }: any): void => {\n    // connection can be undefined if there is no\n    // real-time connection, e.g. when logging in via REST\n    if(connection) {\n      // Obtain the logged in user from the connection\n      // const user = connection.user;\n      \n      // The connection is no longer anonymous, remove it\n      app.channel('anonymous').leave(connection);\n\n      // Add it to the authenticated user channel\n      app.channel('authenticated').join(connection);\n\n      // Channels can be named anything and joined on any condition \n      \n      // E.g. to send real-time events only to admins use\n      // if(user.isAdmin) { app.channel('admins').join(connection); }\n\n      // If the user has joined e.g. chat rooms\n      // if(Array.isArray(user.rooms)) user.rooms.forEach(room => app.channel(`rooms/${room.id}`).join(connection));\n      \n      // Easily organize users by email and userid for things like messaging\n      // app.channel(`emails/${user.email}`).join(connection);\n      // app.channel(`userIds/${user.id}`).join(connection);\n    }\n  });\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  app.publish((data: any, hook: HookContext) => {\n    // Here you can add event publishers to channels set up in `channels.ts`\n    // To publish only for a specific event use `app.publish(eventname, () => {})`\n\n    console.log('Publishing all events to all authenticated users. See `channels.ts` and https://docs.feathersjs.com/api/channels.html for more information.'); // eslint-disable-line\n\n    // e.g. to publish all service events to all authenticated users use\n    return app.channel('authenticated');\n  });\n\n  // Here you can also add service specific event publishers\n  // e.g. the publish the `users` service `created` event to the `admins` channel\n  // app.service('users').publish('created', () => app.channel('admins'));\n  \n  // With the userid and email organization from above you can easily select involved users\n  // app.service('messages').publish(() => {\n  //   return [\n  //     app.channel(`userIds/${data.createdBy}`),\n  //     app.channel(`emails/${data.recipientEmail}`)\n  //   ];\n  // });\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a43848919700a429dcf252bf3d835fc7c21ca512"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/authentication.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/authentication.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":25},"end":{"line":3,"column":62}},"2":{"start":{"line":4,"column":31},"end":{"line":4,"column":74}},"3":{"start":{"line":5,"column":31},"end":{"line":5,"column":74}},"4":{"start":{"line":7,"column":27},"end":{"line":7,"column":74}},"5":{"start":{"line":8,"column":4},"end":{"line":8,"column":71}},"6":{"start":{"line":9,"column":4},"end":{"line":9,"column":81}},"7":{"start":{"line":10,"column":4},"end":{"line":10,"column":47}},"8":{"start":{"line":11,"column":4},"end":{"line":11,"column":57}},"9":{"start":{"line":13,"column":0},"end":{"line":13,"column":28}}},"fnMap":{"0":{"name":"default_1","decl":{"start":{"line":6,"column":9},"end":{"line":6,"column":18}},"loc":{"start":{"line":6,"column":24},"end":{"line":12,"column":1}},"line":6}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1},"f":{"0":1},"b":{},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/authentication.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/authentication.ts"],"names":[],"mappings":";;AACA,+DAAgF;AAChF,2EAAiE;AACjE,2EAAgE;AAUhE,mBAAwB,GAAgB;IACtC,MAAM,cAAc,GAAG,IAAI,sCAAqB,CAAC,GAAG,CAAC,CAAC;IAEtD,cAAc,CAAC,QAAQ,CAAC,KAAK,EAAE,IAAI,4BAAW,EAAE,CAAC,CAAC;IAClD,cAAc,CAAC,QAAQ,CAAC,OAAO,EAAE,IAAI,oCAAa,EAAE,CAAC,CAAC;IAEtD,GAAG,CAAC,GAAG,CAAC,iBAAiB,EAAE,cAAc,CAAC,CAAC;IAC3C,GAAG,CAAC,SAAS,CAAC,mCAAY,EAAE,CAAC,CAAC;AAChC,CAAC;AARD,4BAQC","sourcesContent":["import { ServiceAddons } from '@feathersjs/feathers';\nimport { AuthenticationService, JWTStrategy } from '@feathersjs/authentication';\nimport { LocalStrategy } from '@feathersjs/authentication-local';\nimport { expressOauth } from '@feathersjs/authentication-oauth';\n\nimport { Application } from './declarations';\n\ndeclare module './declarations' {\n  interface ServiceTypes {\n    'authentication': AuthenticationService & ServiceAddons<any>;\n  }\n}\n\nexport default function(app: Application): void {\n  const authentication = new AuthenticationService(app);\n\n  authentication.register('jwt', new JWTStrategy());\n  authentication.register('local', new LocalStrategy());\n\n  app.use('/authentication', authentication);\n  app.configure(expressOauth());\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9441fcfabc6ff705d9a59c2944b133f6ec00e555"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/sequelize.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/sequelize.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":20},"end":{"line":3,"column":40}},"2":{"start":{"line":5,"column":29},"end":{"line":5,"column":45}},"3":{"start":{"line":6,"column":22},"end":{"line":16,"column":6}},"4":{"start":{"line":17,"column":21},"end":{"line":17,"column":30}},"5":{"start":{"line":18,"column":4},"end":{"line":18,"column":42}},"6":{"start":{"line":19,"column":4},"end":{"line":39,"column":6}},"7":{"start":{"line":20,"column":23},"end":{"line":20,"column":49}},"8":{"start":{"line":22,"column":23},"end":{"line":22,"column":39}},"9":{"start":{"line":23,"column":8},"end":{"line":27,"column":11}},"10":{"start":{"line":24,"column":12},"end":{"line":26,"column":13}},"11":{"start":{"line":25,"column":16},"end":{"line":25,"column":47}},"12":{"start":{"line":29,"column":8},"end":{"line":31,"column":12}},"13":{"start":{"line":30,"column":12},"end":{"line":30,"column":62}},"14":{"start":{"line":38,"column":8},"end":{"line":38,"column":22}},"15":{"start":{"line":41,"column":0},"end":{"line":41,"column":28}}},"fnMap":{"0":{"name":"default_1","decl":{"start":{"line":4,"column":9},"end":{"line":4,"column":18}},"loc":{"start":{"line":4,"column":24},"end":{"line":40,"column":1}},"line":4},"1":{"name":"(anonymous_1)","decl":{"start":{"line":19,"column":16},"end":{"line":19,"column":17}},"loc":{"start":{"line":19,"column":35},"end":{"line":39,"column":5}},"line":19},"2":{"name":"(anonymous_2)","decl":{"start":{"line":23,"column":36},"end":{"line":23,"column":37}},"loc":{"start":{"line":23,"column":44},"end":{"line":27,"column":9}},"line":23},"3":{"name":"(anonymous_3)","decl":{"start":{"line":29,"column":55},"end":{"line":29,"column":56}},"loc":{"start":{"line":29,"column":61},"end":{"line":31,"column":9}},"line":29}},"branchMap":{"0":{"loc":{"start":{"line":24,"column":12},"end":{"line":26,"column":13}},"type":"if","locations":[{"start":{"line":24,"column":12},"end":{"line":26,"column":13}},{"start":{"line":24,"column":12},"end":{"line":26,"column":13}}],"line":24}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":3,"11":3,"12":1,"13":1,"14":1,"15":1},"f":{"0":1,"1":1,"2":3,"3":1},"b":{"0":[3,0]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/sequelize.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/sequelize.ts"],"names":[],"mappings":";;AAAA,yCAAsC;AAGtC,mBAAyB,GAAgB;IACvC,MAAM,gBAAgB,GAAG,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;IAC1C,MAAM,SAAS,GAAG,IAAI,qBAAS,CAAC,gBAAgB,EAAE;QAChD,OAAO,EAAE,OAAO;QAChB,OAAO,EAAE,OAAO,CAAC,GAAG;QACpB,MAAM,EAAE;YACN,eAAe,EAAE,IAAI;YACrB,uDAAuD;YACvD,qGAAqG;YACrG,WAAW,EAAE,IAAI;SAClB;QACD,KAAK,EAAE,EAAG,GAAG,EAAE,KAAK,EAAG;KACxB,CAAC,CAAC;IACH,MAAM,QAAQ,GAAG,GAAG,CAAC,KAAK,CAAC;IAE3B,GAAG,CAAC,GAAG,CAAC,iBAAiB,EAAE,SAAS,CAAC,CAAC;IAEtC,GAAG,CAAC,KAAK,GAAG,UAAU,GAAG,IAAI;QAC3B,MAAM,MAAM,GAAG,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QAE1C,gCAAgC;QAChC,MAAM,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC;QAChC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;YACjC,IAAI,WAAW,IAAI,MAAM,CAAC,IAAI,CAAC,EAAE;gBAC9B,MAAM,CAAC,IAAI,CAAS,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;aACzC;QACH,CAAC,CAAC,CAAC;QAEH,uBAAuB;QAEvB,GAAG,CAAC,GAAG,CAAC,eAAe,EAAE,SAAS,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE;YAClD,OAAO,CAAC,GAAG,CAAC,oCAAoC,CAAC,CAAC;QACpD,CAAC,CAAC,CAAC,CAAC;QAEJ,gDAAgD;QAChD;;;;UAIE;QACF,OAAO,MAAM,CAAC;IAEhB,CAAC,CAAC;AACJ,CAAC;AA3CD,4BA2CC","sourcesContent":["import { Sequelize } from 'sequelize';\nimport { Application } from './declarations';\n\nexport default function (app: Application): void {\n  const connectionString = app.get('mysql');\n  const sequelize = new Sequelize(connectionString, {\n    dialect: 'mysql',\n    logging: console.log,\n    define: {\n      freezeTableName: true,\n      //I've observed that without specifying this attribute \n      //the consent Id in the event table was unknown by postgres on CRUD request, but was kown by mysql.  \n      underscored: true\n    },\n    query: {  raw: false  }\n  });\n  const oldSetup = app.setup;\n\n  app.set('sequelizeClient', sequelize);\n\n  app.setup = function (...args): Application {\n    const result = oldSetup.apply(this, args);\n\n    // Setting up data relationships\n    const models = sequelize.models;\n    Object.keys(models).forEach(name => {\n      if ('associate' in models[name]) {\n        (models[name] as any).associate(models);\n      }\n    });\n\n    // Sync to the database\n    \n    app.set('sequelizeSync', sequelize.sync().then(() => {\n      console.log('Re-sync db whithout droping tables');\n    }));\n    \n    //database sync for dev context (droping tables)\n    /*\n    sequelize.sync({ force: true }).then(() => {\n        console.log(\"Drop and re-sync db.\");\n    });\n    */\n    return result;\n\n  };\n}\n\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"375850a5619d2b657e0eabdae6737928c965d4b1"},"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/env.config.ts":{"path":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/env.config.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":8,"column":3}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"2":{"start":{"line":3,"column":26},"end":{"line":3,"column":33}},"3":{"start":{"line":4,"column":4},"end":{"line":4,"column":89}},"4":{"start":{"line":4,"column":71},"end":{"line":4,"column":83}},"5":{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},"6":{"start":{"line":6,"column":26},"end":{"line":6,"column":33}},"7":{"start":{"line":7,"column":4},"end":{"line":7,"column":17}},"8":{"start":{"line":9,"column":25},"end":{"line":13,"column":2}},"9":{"start":{"line":10,"column":4},"end":{"line":10,"column":72}},"10":{"start":{"line":12,"column":4},"end":{"line":12,"column":21}},"11":{"start":{"line":14,"column":19},"end":{"line":20,"column":1}},"12":{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},"13":{"start":{"line":15,"column":31},"end":{"line":15,"column":42}},"14":{"start":{"line":16,"column":17},"end":{"line":16,"column":19}},"15":{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},"16":{"start":{"line":17,"column":21},"end":{"line":17,"column":141}},"17":{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},"18":{"start":{"line":17,"column":109},"end":{"line":17,"column":141}},"19":{"start":{"line":18,"column":4},"end":{"line":18,"column":36}},"20":{"start":{"line":19,"column":4},"end":{"line":19,"column":18}},"21":{"start":{"line":21,"column":0},"end":{"line":21,"column":62}},"22":{"start":{"line":22,"column":0},"end":{"line":22,"column":27}},"23":{"start":{"line":23,"column":15},"end":{"line":23,"column":46}},"24":{"start":{"line":25,"column":4},"end":{"line":25,"column":20}},"25":{"start":{"line":27,"column":4},"end":{"line":36,"column":5}},"26":{"start":{"line":29,"column":12},"end":{"line":29,"column":50}},"27":{"start":{"line":30,"column":12},"end":{"line":30,"column":18}},"28":{"start":{"line":32,"column":12},"end":{"line":32,"column":56}},"29":{"start":{"line":33,"column":12},"end":{"line":33,"column":18}},"30":{"start":{"line":35,"column":12},"end":{"line":35,"column":57}},"31":{"start":{"line":37,"column":4},"end":{"line":37,"column":34}},"32":{"start":{"line":39,"column":0},"end":{"line":39,"column":30}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":74},"end":{"line":2,"column":75}},"loc":{"start":{"line":2,"column":96},"end":{"line":5,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":4,"column":58},"end":{"line":4,"column":59}},"loc":{"start":{"line":4,"column":69},"end":{"line":4,"column":85}},"line":4},"2":{"name":"(anonymous_2)","decl":{"start":{"line":5,"column":6},"end":{"line":5,"column":7}},"loc":{"start":{"line":5,"column":28},"end":{"line":8,"column":1}},"line":5},"3":{"name":"(anonymous_3)","decl":{"start":{"line":9,"column":80},"end":{"line":9,"column":81}},"loc":{"start":{"line":9,"column":95},"end":{"line":11,"column":1}},"line":9},"4":{"name":"(anonymous_4)","decl":{"start":{"line":11,"column":5},"end":{"line":11,"column":6}},"loc":{"start":{"line":11,"column":20},"end":{"line":13,"column":1}},"line":11},"5":{"name":"(anonymous_5)","decl":{"start":{"line":14,"column":50},"end":{"line":14,"column":51}},"loc":{"start":{"line":14,"column":65},"end":{"line":20,"column":1}},"line":14},"6":{"name":"getDotEnv","decl":{"start":{"line":24,"column":9},"end":{"line":24,"column":18}},"loc":{"start":{"line":24,"column":21},"end":{"line":38,"column":1}},"line":24}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":8,"column":3}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":57},"end":{"line":8,"column":2}}],"line":2},"1":{"loc":{"start":{"line":2,"column":57},"end":{"line":8,"column":2}},"type":"cond-expr","locations":[{"start":{"line":2,"column":74},"end":{"line":5,"column":1}},{"start":{"line":5,"column":6},"end":{"line":8,"column":1}}],"line":2},"2":{"loc":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"type":"if","locations":[{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},{"start":{"line":3,"column":4},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},"type":"if","locations":[{"start":{"line":6,"column":4},"end":{"line":6,"column":33}},{"start":{"line":6,"column":4},"end":{"line":6,"column":33}}],"line":6},"4":{"loc":{"start":{"line":9,"column":25},"end":{"line":13,"column":2}},"type":"binary-expr","locations":[{"start":{"line":9,"column":26},"end":{"line":9,"column":30}},{"start":{"line":9,"column":34},"end":{"line":9,"column":57}},{"start":{"line":9,"column":63},"end":{"line":13,"column":1}}],"line":9},"5":{"loc":{"start":{"line":9,"column":63},"end":{"line":13,"column":1}},"type":"cond-expr","locations":[{"start":{"line":9,"column":80},"end":{"line":11,"column":1}},{"start":{"line":11,"column":5},"end":{"line":13,"column":1}}],"line":9},"6":{"loc":{"start":{"line":14,"column":19},"end":{"line":20,"column":1}},"type":"binary-expr","locations":[{"start":{"line":14,"column":20},"end":{"line":14,"column":24}},{"start":{"line":14,"column":28},"end":{"line":14,"column":45}},{"start":{"line":14,"column":50},"end":{"line":20,"column":1}}],"line":14},"7":{"loc":{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},"type":"if","locations":[{"start":{"line":15,"column":4},"end":{"line":15,"column":42}},{"start":{"line":15,"column":4},"end":{"line":15,"column":42}}],"line":15},"8":{"loc":{"start":{"line":15,"column":8},"end":{"line":15,"column":29}},"type":"binary-expr","locations":[{"start":{"line":15,"column":8},"end":{"line":15,"column":11}},{"start":{"line":15,"column":15},"end":{"line":15,"column":29}}],"line":15},"9":{"loc":{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},"type":"if","locations":[{"start":{"line":17,"column":4},"end":{"line":17,"column":141}},{"start":{"line":17,"column":4},"end":{"line":17,"column":141}}],"line":17},"10":{"loc":{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},"type":"if","locations":[{"start":{"line":17,"column":40},"end":{"line":17,"column":141}},{"start":{"line":17,"column":40},"end":{"line":17,"column":141}}],"line":17},"11":{"loc":{"start":{"line":17,"column":44},"end":{"line":17,"column":107}},"type":"binary-expr","locations":[{"start":{"line":17,"column":44},"end":{"line":17,"column":59}},{"start":{"line":17,"column":63},"end":{"line":17,"column":107}}],"line":17},"12":{"loc":{"start":{"line":27,"column":4},"end":{"line":36,"column":5}},"type":"switch","locations":[{"start":{"line":28,"column":8},"end":{"line":30,"column":18}},{"start":{"line":31,"column":8},"end":{"line":33,"column":18}},{"start":{"line":34,"column":8},"end":{"line":35,"column":57}}],"line":27}},"s":{"0":1,"1":2,"2":2,"3":2,"4":2,"5":0,"6":0,"7":0,"8":1,"9":1,"10":0,"11":1,"12":1,"13":0,"14":1,"15":1,"16":1,"17":2,"18":2,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":0,"27":0,"28":0,"29":0,"30":1,"31":1,"32":1},"f":{"0":2,"1":2,"2":0,"3":1,"4":0,"5":1,"6":1},"b":{"0":[1,1,1],"1":[1,0],"2":[2,0],"3":[0,0],"4":[1,1,1],"5":[1,0],"6":[1,1,1],"7":[0,1],"8":[1,1],"9":[1,0],"10":[2,0],"11":[2,2],"12":[0,0,1]},"inputSourceMap":{"version":3,"file":"/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/env.config.ts","sources":["/Users/idristsafack/Compi-Land/Compi-IT/Travaux/test-didomi/user-preferences-center-api/src/env.config.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,+CAAiC;AAEjC,SAAgB,SAAS;IACvB,MAAM,CAAC,MAAM,EAAE,CAAC;IAChB,IAAI,IAAI,CAAC;IACT,QAAQ,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE;QAC9B,KAAK,MAAM;YACT,IAAI,GAAG,GAAG,SAAS,kBAAkB,CAAC;YACtC,MAAM;QACR,KAAK,YAAY;YACf,IAAI,GAAG,GAAG,SAAS,wBAAwB,CAAC;YAC5C,MAAM;QACR;YACE,IAAI,GAAG,GAAG,SAAS,yBAAyB,CAAC;KAC9C;IACD,MAAM,CAAC,MAAM,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;AAChC,CAAC;AAdD,8BAcC","sourcesContent":["import * as dotenv from 'dotenv';\n\nexport function getDotEnv() : void {\n  dotenv.config();\n  let path;\n  switch (process.env.NODE_ENV) {\n  case 'test':\n    path = `${__dirname}/../../.env.test`;\n    break;\n  case 'production':\n    path = `${__dirname}/../../.env.production`;\n    break; \n  default:\n    path = `${__dirname}/../../.env.development`;\n  }\n  dotenv.config({ path: path }); \n}"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c7c7cd24a452189da4ba0aa88612e2e00700fa22"}}